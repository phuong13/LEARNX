import{j as e,s as w,bO as k,q as L,b as N,r as c,T as I,Z as D,o as F,$ as R,O as $,V as C,D as M}from"./index-C1vOwBGC.js";import{S as y}from"./Skeleton-CbBkz2eS.js";import{a as E,u as P,p as S,S as B,b as A,T as K}from"./useForum-CQDzY37R.js";import{d as O}from"./Search-QP3mqxee.js";import{I as U}from"./InputAdornment-BZ7zL1cQ.js";import{R as z}from"./index-fVpE7Ccm.js";import{R as H}from"./ripple-button-CkEzMgzA.js";import{C as W}from"./CircularProgress-CB3Fh7cP.js";const q=()=>e.jsxs(w,{className:"p-3 mb-2",children:[e.jsx(y,{variant:"text",height:24,width:"80%"}),e.jsx(y,{variant:"text",height:16,width:"60%"})]}),J=({nameCourse:s,onClick:a,isActive:o})=>e.jsx("div",{onClick:a,className:`flex items-center gap-2 px-3 py-2 text-slate-600 hover:rounded-lg  w-full transition mb-2 cursor-pointer border-b border-slate-400 ${o?"bg-slate-200 rounded-lg":"bg-gray-100 hover:bg-slate-200"}`,children:e.jsx("span",{className:"text-base font-semibold",children:s})}),Q=()=>{const{courses:s,loading:a}=k(),{createForum:o,loading:m}=E(),f=L(),{t:u}=N(),[p,x]=c.useState(null),[d,h]=c.useState(""),r=t=>{x(t),o(t),f(`/forum/${t}`)},i=c.useMemo(()=>d.trim()?s.filter(t=>t.name.toLowerCase().includes(d.toLowerCase())):s,[s,d]);return e.jsxs("div",{className:"h-full flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-2 p-2",children:[e.jsx("p",{className:"text-slate-600 font-semibold text-lg ",children:u("Forum")}),e.jsx(I,{fullWidth:!0,placeholder:u("forum.search_course_placeholder"),value:d,onChange:t=>h(t.target.value),variant:"outlined",size:"small",InputProps:{startAdornment:e.jsx(U,{position:"start",children:e.jsx(O,{color:"action"})})}})]}),a?e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:Array.from({length:3}).map((t,g)=>e.jsx(q,{},g))}):e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:i.length>0?i.map(t=>e.jsx(J,{nameCourse:t.name,onClick:()=>r(t.id),isActive:p===t.id},t.id)):e.jsx("p",{className:"text-center text-slate-700 py-4",children:u("forum.no_courses_found")})})]})},V=({user:s,content:a,createAt:o,topicId:m})=>{const f=JSON.parse(localStorage.getItem("user")||"{}"),{createTopicComment:u,getTopicComment:p}=P(),{t:x}=N(),[d,h]=c.useState(!1),[r,i]=c.useState(""),[t,g]=c.useState([]),[j,b]=c.useState(!1),l=async()=>{const n=await p(m);console.log("ðŸš€ ~ fetchComment ~ data:",n),g(n.data||[])};c.useEffect(()=>{l()},[]);const v=async()=>{r.trim()&&!d&&(h(!0),await u({content:r,topicId:m}),i(""),await l(),h(!1))},_=n=>{n.key==="Enter"&&!n.shiftKey&&(n.preventDefault(),v())};return e.jsxs("div",{className:"w-full p-4 bg-white rounded-lg shadow-lg border border-slate-200",children:[e.jsxs("div",{className:" flex items-center gap-2",children:[e.jsx("div",{className:"flex-shrink-0 w-[30px] h-[30px] rounded-full overflow-hidden border border-slate-300",children:e.jsx("img",{src:s.avatarUrl||S,alt:"",className:"w-full h-full object-cover"})}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"font-semibold text-sm text-slate-700 truncate",children:s.username}),e.jsx("span",{className:"text-sm text-slate-500",children:T(o)})]})})]}),e.jsx("div",{className:"flex my-2 mx-4",children:e.jsx("p",{className:"text-slate-700 text-sm ",children:e.jsx("p",{dangerouslySetInnerHTML:{__html:a}})})}),e.jsxs("div",{className:"px-4 border-t border-slate-300 mx-2",children:[e.jsx("div",{className:"flex items-center gap-2 text-slate-600 cursor-pointer mt-2",onClick:()=>b(!j),children:e.jsx("span",{className:"text-sm text-slate-500 hover:underline hover:text-slate-600 transition",children:x("topic.comments_count",{count:t.length})})}),j&&e.jsx("div",{className:"px-4 my-2 space-y-2",children:t.length===0?e.jsx("p",{className:"text-slate-400 text-sm",children:x("topic.no_comments")}):t.map(n=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"flex-shrink-0 w-[30px] h-[30px] rounded-full overflow-hidden border border-slate-300",children:e.jsx("img",{src:n.account.avatarUrl||S,alt:"",className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-1 bg-slate-50 p-2 rounded-md",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{className:"font-semibold text-sm text-slate-700",children:n.account.email}),e.jsx("div",{className:"text-sm text-slate-500",children:T(n.createdAt)})]}),e.jsx("p",{className:"text-slate-700 text-sm",children:n.content})]})]},n.id))})]}),e.jsxs("div",{className:"px-4 flex items-center gap-3 mt-2",children:[e.jsx("div",{className:"flex-shrink-0 w-[30px] h-[30px] rounded-full overflow-hidden border border-slate-300",children:e.jsx("img",{src:f.avatar,alt:"",className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:r,onChange:n=>i(n.target.value),onKeyDown:_,placeholder:x("topic.comment_input_placeholder"),className:"w-full py-2 px-3 border-b border-slate-300 focus:outline-none text-slate-600 "}),e.jsx("button",{className:"absolute right-2 top-1/2 -translate-y-1/2 contrast-50 hover:contrast-200 transition",onClick:v,disabled:d,children:d?e.jsx(D,{className:"w-5 h-5 animate-spin text-primaryDark"}):e.jsx(B,{className:"w-5 h-5"})})]})]})]})},T=s=>{const a=new Date(s[0],s[1]-1,s[2],s[3],s[4],s[5],Math.floor(s[6]/1e6)),o=m=>String(m).padStart(2,"0");return`${o(a.getHours())}:${o(a.getMinutes())}
     ${o(a.getDate())}/${o(a.getMonth()+1)}/${a.getFullYear()}`},Y={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"90%",maxWidth:600,bgcolor:"background.paper",borderRadius:2,boxShadow:24,p:4},Z=()=>{const[s,a]=c.useState(!1),[o,m]=c.useState(""),[f,u]=c.useState([]),[p,x]=c.useState(!1),[d,h]=c.useState(!1),{forumId:r}=F(),{t:i}=N(),{createTopic:t,getTopics:g}=A(),j=async()=>{if(r){x(!0);try{const l=await g(r);u(l.data||[])}catch(l){console.error("Lá»—i khi láº¥y danh sÃ¡ch topics:",l)}finally{x(!1)}}};c.useEffect(()=>{j()},[r]);const b=async()=>{if(!(!o.trim()||!r)){h(!0);try{await t({content:o,forumId:r}),await j(),a(!1),m("")}catch(l){console.error("Lá»—i khi táº¡o topic:",l)}finally{h(!1)}}};return e.jsxs("div",{className:"flex flex-col gap-4 p-4 h-full focus:outline-none",tabIndex:-1,children:[r?e.jsx(H,{onClick:()=>a(!0),children:i("forum.create_topic")}):e.jsx("div",{className:"text-lg text-center text-slate-600 font-semibold pt-6 h-full bg-white rounded-lg shadow-md",children:i("forum.please_select_forum")}),p?e.jsx("div",{className:"flex flex-col gap-4 h-full bg-white rounded-lg shadow-md p-6",children:Array.from({length:3}).map((l,v)=>e.jsx(K,{},v))}):f.length>0&&r?e.jsx("div",{className:"flex flex-col gap-4 h-full bg-white rounded-lg shadow-md p-6 overflow-y-auto",children:f.map(l=>e.jsx(V,{topicId:l.id,user:l.account,content:l.content,createAt:l.createdAt},l.id))}):r&&e.jsx("div",{className:"text-center mt-6 text-slate-600 font-semibold",children:i("forum.no_topics")}),e.jsx(R,{open:s,onClose:()=>a(!1),"aria-labelledby":"modal-title","aria-describedby":"modal-description",children:e.jsxs(w,{sx:Y,children:[e.jsx($,{id:"modal-title",variant:"h6",component:"h2",sx:{mb:2},children:i("forum.new_topic_title")}),e.jsx(z,{theme:"snow",value:o,onChange:m,style:{height:200,marginBottom:52},placeholder:i("forum.new_topic_placeholder")}),e.jsxs(w,{sx:{display:"flex",justifyContent:"flex-end",gap:2},children:[e.jsx(C,{variant:"outlined",color:"secondary",onClick:()=>a(!1),sx:{borderRadius:2},disabled:d,children:i("forum.cancel")}),e.jsx(C,{variant:"contained",color:"primary",onClick:b,sx:{borderRadius:2},disabled:d,children:d?e.jsx(W,{size:20,color:"inherit"}):i("forum.submit")})]})]})})]})},G=()=>e.jsxs("div",{className:"flex h-full",children:[e.jsx("div",{className:" w-1/4 h-full bg-white p-4 m-4 rounded-lg",children:e.jsx(Q,{})}),e.jsx("div",{className:"flex-grow overflow-y-auto custom-scrollbar",children:e.jsx(Z,{})})]}),ne=()=>e.jsxs("div",{className:"flex flex-col min-h-[calc(100vh-170px)] ",children:[e.jsx(M,{title:"Forum"}),e.jsx("div",{className:"flex-grow h-0 overflow-hidden bg-slate-200",children:e.jsx(G,{})})]});export{ne as default};
