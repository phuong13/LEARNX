import{d as I,aE as F,aG as B,aH as A,aF as se,r as m,V as C,ay as L,j as e,D as _,X as ae,Y as R,L as Y,aa as ne,ab as ie,ac as le,a9 as re,aB as H,aA as ce,T as W,az as G,a2 as y,a3 as w,c as oe}from"./index-Cj6YTJ_U.js";import{I as O}from"./IconButton-CU6_sH0W.js";import{M as de}from"./MenuItem-N0jaAuLd.js";import{C as me}from"./chevron-right-C4n5-d4l.js";import{C as P}from"./Chip-BdYVqZiD.js";/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=I("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=I("CircleHelp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=I("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);function xe(a,t){const s=()=>se(t==null?void 0:t.in,NaN),r=Ne(a);let i;if(r.date){const l=je(r.date,2);i=ye(l.restDateString,l.year)}if(!i||isNaN(+i))return s();const u=+i;let o=0,h;if(r.time&&(o=be(r.time),isNaN(o)))return s();if(r.timezone){if(h=ve(r.timezone),isNaN(h))return s()}else{const l=new Date(u+o),f=F(0,t==null?void 0:t.in);return f.setFullYear(l.getUTCFullYear(),l.getUTCMonth(),l.getUTCDate()),f.setHours(l.getUTCHours(),l.getUTCMinutes(),l.getUTCSeconds(),l.getUTCMilliseconds()),f}return F(u+o+h,t==null?void 0:t.in)}const D={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},fe=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,ge=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,pe=/^([+-])(\d{2})(?::?(\d{2}))?$/;function Ne(a){const t={},s=a.split(D.dateTimeDelimiter);let n;if(s.length>2)return t;if(/:/.test(s[0])?n=s[0]:(t.date=s[0],n=s[1],D.timeZoneDelimiter.test(t.date)&&(t.date=a.split(D.timeZoneDelimiter)[0],n=a.substr(t.date.length,a.length))),n){const r=D.timezone.exec(n);r?(t.time=n.replace(r[1],""),t.timezone=r[1]):t.time=n}return t}function je(a,t){const s=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),n=a.match(s);if(!n)return{year:NaN,restDateString:""};const r=n[1]?parseInt(n[1]):null,i=n[2]?parseInt(n[2]):null;return{year:i===null?r:i*100,restDateString:a.slice((n[1]||n[2]).length)}}function ye(a,t){if(t===null)return new Date(NaN);const s=a.match(fe);if(!s)return new Date(NaN);const n=!!s[4],r=j(s[1]),i=j(s[2])-1,u=j(s[3]),o=j(s[4]),h=j(s[5])-1;if(n)return Ie(t,o,h)?De(t,o,h):new Date(NaN);{const l=new Date(0);return!we(t,i,u)||!Se(t,r)?new Date(NaN):(l.setUTCFullYear(t,i,Math.max(r,u)),l)}}function j(a){return a?parseInt(a):1}function be(a){const t=a.match(ge);if(!t)return NaN;const s=S(t[1]),n=S(t[2]),r=S(t[3]);return Te(s,n,r)?s*B+n*A+r*1e3:NaN}function S(a){return a&&parseFloat(a.replace(",","."))||0}function ve(a){if(a==="Z")return 0;const t=a.match(pe);if(!t)return 0;const s=t[1]==="+"?-1:1,n=parseInt(t[2]),r=t[3]&&parseInt(t[3])||0;return Ee(n,r)?s*(n*B+r*A):NaN}function De(a,t,s){const n=new Date(0);n.setUTCFullYear(a,0,4);const r=n.getUTCDay()||7,i=(t-1)*7+s+1-r;return n.setUTCDate(n.getUTCDate()+i),n}const Ce=[31,null,31,30,31,30,31,31,30,31,30,31];function V(a){return a%400===0||a%4===0&&a%100!==0}function we(a,t,s){return t>=0&&t<=11&&s>=1&&s<=(Ce[t]||(V(a)?29:28))}function Se(a,t){return t>=1&&t<=(V(a)?366:365)}function Ie(a,t,s){return t>=1&&t<=53&&s>=0&&s<=6}function Te(a,t,s){return a===24?t===0&&s===0:s>=0&&s<60&&t>=0&&t<60&&a>=0&&a<25}function Ee(a,t){return t>=0&&t<=59}function Me({title:a,startDate:t,endDate:s}){const[n,r]=m.useState([]),[i,u]=m.useState(null),[o,h]=m.useState(null),[l,f]=m.useState(0),[ke,J]=m.useState(null),{assignmentId:b}=C(),[K,v]=m.useState(!1),[T,E]=m.useState(!1),{courseId:M}=C(),X=d=>{const c=new Date(s),N=xe(d),x=c-N,g=Math.abs(x),p=Math.floor(g/(1e3*60*60*24)),U=Math.floor(g%(1e3*60*60*24)/(1e3*60*60)),$=Math.floor(g%(1e3*60*60)/(1e3*60)),z=Math.floor(g%(1e3*60)/1e3);return N<c?e.jsxs("div",{className:"py-1 text-blue-500",children:["Nộp sớm ",p>0?`${p} ngày `:"",U," giờ ",$," phút ",z," giây"]}):e.jsxs("div",{className:"py-1 text-rose-600",children:["Nộp trễ ",p>0?`${p} ngày `:"",U," giờ ",$," phút ",z," giây"]})};L(new Date(t),"EEEE, dd 'tháng' MM yyyy, hh:mm a",{locale:G});const q=L(new Date(s),"EEEE, dd 'tháng' MM yyyy, hh:mm a",{locale:G});m.useEffect(()=>{(async()=>{v(!0);try{const c=await y.get(`courses/${M}`);c.status===200&&h(c.data.data)}catch{}finally{v(!1)}})()},[M]);const Q=async()=>{i.score===null?w.error("Vui lòng nhập điểm",{duration:1e3}):(E(!0),await y.post(`/assignment-submissions/${b}/${i.studentId}/score`,{score:i.score}).then(d=>{w.success("Đã cập nhật điểm",{duration:1e3}),k()}).catch(d=>{w.error(d.response.data.message,{duration:1e3})}).finally(()=>{E(!1)}))};m.useEffect(()=>{(async()=>{v(!0);try{const c=await y.get(`/assignment-submissions/assignment/${b}`);r(c.data.data),u(c.data.data[l]),J([{uri:`http://localhost:8000/proxy?url=${c.data.data[l].fileSubmissionUrl}`}])}catch(c){console.log(c)}finally{v(!1)}})()},[b]),m.useEffect(()=>{u(n[l])},[l]);const ee=d=>{const c=new Date,x=new Date(d)-c;if(x<=0)return"Đã hết hạn";const g=Math.floor(x/(1e3*60*60*24)),p=Math.floor(x%(1e3*60*60*24)/(1e3*60*60));return`Còn lại ${g} ngày ${p} giờ`},k=()=>{f(d=>d===n.length-1?0:d+1)},te=()=>{f(d=>d===0?n.length-1:d-1)};return e.jsxs("div",{className:"m-4 p-4 flex-1 rounded-lg bg-white",children:[e.jsx(_,{title:"Chấm điểm bài nộp"}),K?e.jsx(ae,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:300},children:e.jsx(R,{})}):n.length===0?e.jsx("div",{className:"text-slate-600 font-bold text-center flex justify-center items-center",children:"Chưa có học sinh nào nộp bài"}):e.jsxs(e.Fragment,{children:[i&&e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4",children:[e.jsx("div",{className:"bg-primaryDark text-white px-4 py-2 rounded-lg text-sm font-semibold shadow-md",children:e.jsx("div",{className:"space-y-1",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-white",children:"Khoá học:"}),o&&e.jsxs(e.Fragment,{children:[e.jsx(Y,{to:`/course-detail/${o==null?void 0:o.id}`,className:"text-white hover:underline",children:(o==null?void 0:o.name)||"Đang tải..."}),e.jsx("span",{children:"/"}),e.jsx(Y,{to:`/submission/${o==null?void 0:o.id}/${b}`,className:"text-white hover:underline",children:a})]})]})})}),e.jsx("div",{className:"text-xl font-bold text-slate-700 pl-24",children:"Chấm điểm"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{size:"small",onClick:te,children:e.jsx(ue,{className:"w-4 h-4"})}),e.jsxs(ne,{size:"small",variant:"outlined",children:[e.jsx(ie,{id:"student-select-label",children:"Email"}),e.jsx(le,{labelId:"student-select-label",label:"Email",value:i.studentEmail,onChange:d=>f(n.findIndex(c=>c.studentEmail===d.target.value)),sx:{minWidth:180},children:n.map((d,c)=>e.jsx(de,{value:d.studentEmail,children:d.studentEmail},c))})]}),e.jsx(O,{size:"small",onClick:k,children:e.jsx(me,{className:"w-4 h-4"})})]}),e.jsxs(re,{variant:"body2",color:"text.secondary",children:[l+1," of ",n.length]})]})]}),i?e.jsxs("div",{className:"border border-slate-200 bg-slate-50 text-slate-700 rounded-lg mx-64",children:[i&&e.jsxs("div",{className:"p-4 flex",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(he,{className:"w-6 h-6 text-slate-800"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-700",children:i.studentName}),e.jsx("div",{className:"text-sm text-slate-700",children:i.studentEmail})]})]}),i.score!==null?e.jsx(P,{label:`Điểm: ${i.score}`,color:"success",variant:"filled",className:"ml-auto text-lg ",sx:{fontSize:"1.1rem",px:2,py:1,bgcolor:"#8CD77A",color:"white",borderRadius:"8px"}}):e.jsx(P,{label:"Chưa chấm điểm",color:"error",variant:"filled",className:"ml-auto text-lg ",sx:{fontSize:"1.1rem",px:2,py:2,bgcolor:"#E44640",color:"white",borderRadius:"8px"}})]}),e.jsxs("div",{className:"px-4",children:[e.jsxs("div",{className:"",children:[e.jsxs("div",{className:"flex items-center font-semibold gap-2",children:[e.jsx(H,{className:" mb-1 mr-2",size:16}),"Hạn chót: ",e.jsxs("div",{className:"font-medium",children:[" ",q]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"font-semibold",size:16}),e.jsx("div",{className:"py-2 text-slate-700 font-semibold",children:"Thời gian còn lại:"}),e.jsx("div",{className:" flex items-center",children:ee(s)})]})]}),e.jsxs("div",{className:"flex items-center gap-2 font-semibold",children:[e.jsx(H,{className:"inline mb-1 mr-2 ",size:16}),"Thời gian nộp: ",X(i.createdAt)]})]}),i&&e.jsxs("div",{className:" shadow rounded-lg p-4",children:[e.jsx("h2",{className:"text-xl font-semibold mb-1",children:"Bài nộp"}),e.jsxs("div",{className:"space-y-4",children:[i.fileSubmissionUrl&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{children:"File đã nộp:"}),e.jsx("a",{href:`http://docs.google.com/gview?url=${i.fileSubmissionUrl}&embedded=true`,target:"_blank",rel:"noopener noreferrer",className:"hover:underline text-blue-500",children:decodeURIComponent(i.fileSubmissionUrl.split("/").pop())})]}),i.textSubmission&&e.jsx("div",{className:"text-sm text-slate-600",children:i.textSubmission})]})]}),i&&e.jsxs("div",{className:" shadow rounded-lg px-4 mb-4",children:[e.jsxs("h2",{className:"text-xl font-semibold flex items-center gap-2 mb-2",children:["Nhận xét",e.jsx(Z,{className:"w-4 h-4 text-slate-400"})]}),e.jsx(W,{label:"Nhận xét cho học sinh",multiline:!0,minRows:3,fullWidth:!0,variant:"outlined",className:"mb-4"}),e.jsxs("h2",{className:"text-xl font-semibold  pt-4 flex items-center gap-2",children:["Chấm điểm",e.jsx(Z,{className:"w-4 h-4 text-slate-400"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"grade",className:"block text-sm font-medium text-slate-700",children:"Thang điểm 10"}),e.jsx(W,{type:"number",id:"grade",inputProps:{max:10,min:0},value:i.score??"",fullWidth:!0,size:"small",className:"mt-1",onChange:d=>{const c=d.target.value;if(c===""||Number(c)>=1&&Number(c)<=10){const N=c?parseFloat(c):null,x=[...n];x[l].score=N,r(x)}}}),e.jsxs("div",{className:"flex justify-end gap-2 ",children:[e.jsx("button",{className:"py-2 px-6 bg-primaryDark text-white rounded-lg  hover:bg-secondary transition-colors",children:"Hủy"}),e.jsxs("button",{onClick:Q,className:"py-2 px-6 bg-primaryDark text-white rounded-lg  hover:bg-secondary transition-colors flex items-center gap-2",disabled:T,children:[T&&e.jsx(R,{size:20,color:"inherit"}),"Chấm điểm"]})]})]})]})]}):e.jsx("div",{className:"text-slate-600 font-bold text-center flex justify-center items-center",children:"Chưa có học sinh nào nộp bài"})]})]})}const Re=()=>{const{courseId:a}=C(),{assignmentId:t}=C(),[s,n]=m.useState(null),[r,i]=m.useState(null),[u,o]=m.useState(!1);return m.useEffect(()=>{(async()=>{o(!0);try{const l=await y.get(`courses/${a}`);l.status===200&&i(l.data.data)}catch(l){console.log(l)}finally{o(!1)}})()},[a]),m.useEffect(()=>{(async()=>{o(!0);try{const l=await y.get(`/assignments/${t}`,{headers:{"Content-Type":"application/json"}});n(l.data.data)}catch(l){console.log(l)}finally{o(!1)}})()},[t]),e.jsxs(e.Fragment,{children:[e.jsx(_,{title:"Nộp bài"}),e.jsxs("div",{className:"flex flex-col min-h-[calc(100vh-193px)]",children:[u&&e.jsx(oe,{isLoading:u}),!u&&s&&e.jsx(Me,{title:s.title,startDate:s.startDate,endDate:s.endDate})]})]})};export{Re as default};
