import{d as U,P as se,V as C,r as n,j as e,aA as B,a2 as y,K as te,M as ae,ay as M,u as ne,c as P,B as le,L as k,aB as O,aC as ie,Z as re,az as I,a3 as S,D as oe}from"./index-OOWise-w.js";import{C as q}from"./Chip-DD4EAc5P.js";/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=U("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]);/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=U("FileCheck",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]]);/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=U("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);function V({timeRemaining:b}){const{assignmentId:p}=C(),[i,c]=n.useState([]);n.useEffect(()=>{(async()=>{await y.get(`/assignment-submissions/assignment/${p}`).then(d=>{c(d.data.data)}).catch(d=>{console.log(d)})})()},[p]),i.length;const N=i.filter(r=>r.fileSubmissionUrl||r.textSubmission).length,v=i.filter(r=>r.score===null||r.score===void 0).length;return e.jsxs("div",{className:" p-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-700 mb-2",children:"Thống kê điểm số"}),e.jsx("div",{className:"rounded-lg overflow-hidden bg-white shadow",children:e.jsx("table",{className:"w-full",children:e.jsxs("tbody",{children:[e.jsxs("tr",{className:"border-b border-slate-300",children:[e.jsxs("td",{className:"py-3 flex items-center font-medium text-slate-700",children:[e.jsx(de,{className:"w-5 h-5 text-green-500 mr-3"}),"Đã nộp bài"]}),e.jsx("td",{className:"py-3 font-semibold text-slate-700",children:N})]}),e.jsxs("tr",{className:"border-b border-slate-300",children:[e.jsxs("td",{className:"py-3 flex items-center font-medium text-slate-700",children:[e.jsx(ce,{className:"w-5 h-5 text-yellow-500 mr-3"}),"Cần chấm điểm"]}),e.jsx("td",{className:"py-3 font-semibold text-slate-700",children:v})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"py-3 flex items-center font-medium text-slate-700",children:[e.jsx(B,{className:"w-5 h-5 text-red-500 mr-3"}),"Thời gian còn lại"]}),e.jsx("td",{className:"py-3 font-semibold text-slate-700",children:b})]})]})})})]})}V.propTypes={timeRemaining:se.string.isRequired};var F={},he=ae;Object.defineProperty(F,"__esModule",{value:!0});var L=F.default=void 0,xe=he(te()),ue=e;L=F.default=(0,xe.default)((0,ue.jsx)("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12z"}),"Cancel");function fe({title:b,content:p,startDate:i,endDate:c}){const[N,v]=n.useState(!1),[r,d]=n.useState(!0),[h,o]=n.useState(null),[j,K]=n.useState(null),[G,T]=n.useState(!1),W=i&&!isNaN(new Date(i))?M(new Date(i),"EEEE, dd 'tháng' MM yyyy, hh:mm a",{locale:I}):"Invalid date",Z=c&&!isNaN(new Date(c))?M(new Date(c),"EEEE, dd 'tháng' MM yyyy, hh:mm a",{locale:I}):"Invalid date",{authUser:$}=ne(),J=()=>{v(!N)},[Q,u]=n.useState(!0),[a,w]=n.useState(null),{assignmentId:D}=C(),{courseId:A}=C(),z=s=>{const t=new Date(c),l=new Date(s),f=l-t,x=Math.abs(f),m=Math.floor(x/(1e3*60*60*24)),g=Math.floor(x/(1e3*60*60)%24),H=Math.floor(x/(1e3*60)%60),_=Math.floor(x/1e3%60);return l<t?e.jsxs("td",{className:"py-3 text-blue-500",children:["Nộp sớm ",m>0?`${m} ngày `:"",g," giờ ",H," phút ",_," giây"]}):e.jsxs("td",{className:"py-3 text-rose-600",children:["Nộp trễ ",m>0?`${m} ngày `:"",g," giờ ",H," phút ",_," giây"]})},E=s=>{if(Array.isArray(s)&&s.length>=6){const[t,l,f,x,m,g]=s;return new Date(t,l-1,f,x,m,g)}return null};n.useEffect(()=>{(async()=>{u(!0);const t=await y.get(`courses/${A}`);t.status===200&&(K(t.data.data),u(!1))})()},[A]),n.useEffect(()=>{(async()=>{u(!0);try{const t=await y.get(`/assignment-submissions/${D}/logged-in`);t.data.data.fileSubmissionUrl!=null?w(t.data.data):w(null)}catch{w(null)}finally{u(!1)}})()},[D]);const R=s=>{const t=new Date,l=new Date(s);if(isNaN(l.getTime()))return"Ngày hết hạn không hợp lệ";const f=l.getTime()-t.getTime();if(f<=0)return"Đã hết hạn";const x=Math.floor(f/(1e3*60*60*24)),m=Math.floor(f%(1e3*60*60*24)/(1e3*60*60)),g=Math.floor(f%(1e3*60*60)/(1e3*60));return x>0?`Còn lại ${x} ngày ${m} giờ`:m>0?`Còn lại ${m} giờ ${g} phút`:`Còn lại ${g} phút`},X=()=>{d(!r)},Y=s=>{o(s.target.files[0])},ee=async()=>{const s=new FormData;s.append("document",h);try{if(a){u(!0);const t=await y.patch(`/assignment-submissions/${D}`,s,{headers:{"Content-Type":"multipart/form-data"}});u(!1),console.log(t),t.status===200?(S.success(t.data.message),w(t.data.data)):S.error(t.data.message,{type:"error"})}else{const t={assignmentId:D,textSubmission:""};s.append("assignment",new Blob([JSON.stringify(t)],{type:"application/json"})),u(!0);const l=await y.post("/assignment-submissions",s,{headers:{"Content-Type":"multipart/form-data"}});console.log(l),u(!1),l.status===201||l.status===200?(S.success(l.data.message),w(l.data.data)):S.error(l.data.message,{type:"error"})}}catch(t){S.error(t.response.data.message,{type:"error"})}};return e.jsx("div",{className:"",children:Q?e.jsx("div",{className:"flex justify-center items-center h-full",children:e.jsx(P,{isLoading:!0})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative h-48 bg-emerald-200 overflow-hidden",children:[e.jsx("img",{src:le,alt:"Online learning illustration",className:"w-full h-fit object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-30"}),e.jsx("div",{className:"absolute top-4 left-4 right-4 flex justify-between items-start",children:e.jsx("div",{className:"flex items-center",children:e.jsx("div",{className:"bg-primaryDark text-white px-4 py-2 rounded-lg text-sm font-semibold shadow-md",children:e.jsx("nav",{"aria-label":"breadcrumb",children:e.jsxs("ol",{className:"flex items-center space-x-2",children:[e.jsx("i",{className:"fa-solid fa-file-arrow-up text-white text-xl mr-2"}),e.jsx("li",{children:e.jsx(k,{to:"/",className:"text-white hover:underline",children:"Trang chủ"})}),e.jsx("li",{children:e.jsx("span",{className:"mx-2 text-gray-300",children:"/"})}),e.jsx("li",{children:e.jsx(k,{to:"/my-course",className:"text-white hover:underline",children:"Khóa học"})}),e.jsx("li",{children:e.jsx("span",{className:"mx-2 text-gray-300",children:"/"})}),e.jsx(k,{to:`/course-detail/${j==null?void 0:j.id}`,className:"text-white hover:underline",children:(j==null?void 0:j.name)||"Đang tải..."}),e.jsx("li",{children:e.jsx("span",{className:"mx-2 text-gray-300",children:"/"})}),e.jsx("li",{className:"text-gray-200",children:b||"Đang tải..."})]})})})})})]}),e.jsx("div",{className:"pt-4 relative",children:e.jsxs("div",{className:"bg-white shadow-lg overflow-hidden rounded-lg",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsx("h2",{className:"text-lg font-semibold mb-2 text-slate-700",children:"Thời gian"}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between text-sm text-gray-600",children:[e.jsxs("p",{className:"mb-2 sm:mb-0",children:[e.jsx(O,{className:"inline mr-2",size:16})," Opened: ",W]}),e.jsxs("p",{children:[e.jsx(O,{className:"inline mr-2",size:16})," Due: ",Z]})]})]}),e.jsxs("div",{className:"p-4 border-b border-slate-700 flex flex-col ",children:[e.jsx("h2",{className:"text-lg font-semibold mb-2 text-slate-700",children:"Hướng dẫn nộp bài"}),e.jsx("div",{className:"pb-2",dangerouslySetInnerHTML:{__html:p}}),$.role==="TEACHER"?e.jsx(k,{to:`/grading/${A}/${D}`,className:"text-white flex justify-center",children:e.jsx("button",{className:"py-2 px-6  bg-primaryDark text-white rounded-lg  hover:bg-secondary transition-colors",children:"Chấm điểm"})}):e.jsx("div",{className:"flex justify-center",children:e.jsxs("button",{onClick:J,className:"py-2 px-6 bg-primaryDark text-white rounded-lg hover:bg-secondary transition-colors flex items-center w-fit gap-2",children:[e.jsx("i",{className:"fa-solid fa-folder-plus"}),a?"Sửa bài nộp":"Thêm bài nộp"]})}),N&&e.jsxs("div",{className:`mt-2 p-4 pt-12 bg-slate-100 rounded-lg shadow-md border-2 border-dashed transition-colors duration-200 ${G?"border-blue-400 bg-blue-50":"border-slate-300"}`,onDragOver:s=>{s.preventDefault(),T(!0)},onDragLeave:s=>{s.preventDefault(),T(!1)},onDrop:s=>{s.preventDefault(),T(!1),s.dataTransfer.files&&s.dataTransfer.files[0]&&o(s.dataTransfer.files[0])},onClick:()=>{var s;(s=document.getElementById("hidden-upload-input"))==null||s.click()},style:{cursor:"pointer"},children:[!h&&e.jsx("div",{className:"text-base font-semibold mb-2 text-center text-slate-500",children:"Kéo & thả file vào đây hoặc click để chọn file"}),h&&e.jsx("div",{className:"mt-2 flex justify-center",children:e.jsx(q,{label:h.name,color:"primary",onDelete:()=>o(null),deleteIcon:e.jsx(L,{}),variant:"outlined",sx:{fontWeight:500,fontSize:15,px:1.5}})}),e.jsx("input",{id:"hidden-upload-input",type:"file",accept:".pdf,.doc,.docx,.xlsx,.xls",style:{display:"none"},onChange:Y}),a&&!h&&a.fileSubmissionUrl&&e.jsx("div",{className:"mt-2 flex justify-center",children:e.jsx(q,{label:decodeURIComponent(a.fileSubmissionUrl.split("/").pop()),color:"success",variant:"outlined",onDelete:()=>o(null),deleteIcon:e.jsx(L,{}),sx:{fontWeight:500,fontSize:15,px:1.5}})}),e.jsx("div",{className:"flex justify-center mt-12",children:e.jsx("button",{onClick:s=>{s.stopPropagation(),ee()},disabled:!h,className:` text-white text-m px-3 py-1 rounded-lg transition-colors shadow-md ${h?"bg-blue-400 hover:bg-blue-600":"bg-slate-300 cursor-not-allowed"}`,children:"Nộp bài"})})]})]}),$.role==="STUDENT"&&e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2 cursor-pointer",onClick:X,children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-700",children:"Trạng thái bài nộp"}),r?e.jsx(ie,{size:20}):e.jsx(re,{size:20})]}),r&&e.jsx("table",{className:"w-full",children:e.jsxs("tbody",{children:[e.jsxs("tr",{className:"border-b border-slate-300",children:[e.jsx("td",{className:"py-3 font-medium text-gray-700",children:"Thời gian nộp"}),a?e.jsx(e.Fragment,{children:a.updatedAt?z(E(a.updatedAt)):z(E(a.createdAt))}):e.jsx("td",{className:"py-3 text-rose-600",children:"Chưa nộp bài"})]}),e.jsxs("tr",{className:"border-b border-slate-300",children:[e.jsx("td",{className:"py-3 font-medium text-gray-700",children:"File đã nộp"}),a&&a.fileSubmissionUrl?e.jsx("td",{className:" text-gray-600",children:e.jsxs("div",{className:"flex",children:[e.jsx(me,{className:"mr-2 text-blue-600",size:18}),e.jsx("a",{className:"text-blue-500 hover:underline",href:`http://docs.google.com/gview?url=${a.fileSubmissionUrl}&embedded=true`,children:decodeURIComponent(a.fileSubmissionUrl.split("/").pop())})]})}):e.jsx("td",{className:"py-3 text-gray-600"})]}),e.jsxs("tr",{className:"border-b border-slate-300",children:[e.jsx("td",{className:"py-3 font-medium text-gray-700",children:"Điểm"}),e.jsx("td",{className:"py-3 text-gray-600",children:a?a.score?a.score:"Chưa chấm điểm":"..."})]}),e.jsxs("tr",{className:"border-b border-slate-300",children:[e.jsx("td",{className:"py-3 font-medium text-gray-700",children:"Thời gian còn lại"}),e.jsxs("td",{className:"py-3 text-gray-600 flex items-center",children:[e.jsx(B,{className:"mr-2",size:16}),R(c)]})]}),e.jsxs("tr",{className:"border-b border-slate-300",children:[e.jsx("td",{className:"py-3 font-medium text-gray-700",children:"Chỉnh sửa lần cuối"}),e.jsx("td",{className:"py-3 text-gray-600",children:a&&a.updatedAt?M(E(a.updatedAt),"EEEE, dd 'tháng' MM yyyy, hh:mm a",{locale:I}):a&&M(E(a.createdAt),"EEEE, dd 'tháng' MM yyyy, hh:mm a",{locale:I})})]})]})})]}),e.jsx("div",{className:"",children:$.role==="TEACHER"&&e.jsx(V,{timeRemaining:R(c)})})]})})]})})}const ye=()=>{const{courseId:b}=C(),{assignmentId:p}=C(),[i,c]=n.useState(null),[N,v]=n.useState(null),[r,d]=n.useState(!1);return n.useEffect(()=>{(async()=>{d(!0);try{const o=await y.get(`courses/${b}`);o.status===200&&v(o.data.data)}catch(o){console.log(o)}finally{d(!1)}})()},[b]),n.useEffect(()=>{(async()=>{d(!0);try{const o=await y.get(`/assignments/${p}`,{headers:{"Content-Type":"application/json"}});c(o.data.data)}catch(o){console.log(o)}finally{d(!1)}})()},[p]),e.jsxs(e.Fragment,{children:[e.jsx(oe,{title:"Nộp bài"}),e.jsx("div",{className:"flex flex-col min-h-[calc(100vh-193px)]",children:e.jsx("div",{className:"flex-1 pr-6 pl-6",children:r?e.jsx(P,{isLoading:r,className:"flex justify-center items-center h-full"}):i&&e.jsx(fe,{title:i.title,content:i.content,startDate:i.startDate,endDate:i.endDate})})})]})};export{ye as default};
