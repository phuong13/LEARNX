import{c as S,an as U,ap as R,aq as L,ao as q,r as m,o as v,aj as $,j as e,D as O,L as z,M as J,N as K,S as V,T as Q,O as F,al as X,ak as Y,w as y,B as w}from"./index-37xMIgAO.js";import{I as H}from"./IconButton-DDP9_hHQ.js";import{M as ee}from"./MenuItem-CBQRTv1F.js";import{C as te}from"./chevron-right-BflAJ-ar.js";/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=S("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=S("CircleHelp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=S("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);function ie(a,t){const s=()=>q(t==null?void 0:t.in,NaN),r=oe(a);let i;if(r.date){const o=de(r.date,2);i=me(o.restDateString,o.year)}if(!i||isNaN(+i))return s();const h=+i;let l=0,u;if(r.time&&(l=ue(r.time),isNaN(l)))return s();if(r.timezone){if(u=he(r.timezone),isNaN(u))return s()}else{const o=new Date(h+l),x=U(0,t==null?void 0:t.in);return x.setFullYear(o.getUTCFullYear(),o.getUTCMonth(),o.getUTCDate()),x.setHours(o.getUTCHours(),o.getUTCMinutes(),o.getUTCSeconds(),o.getUTCMilliseconds()),x}return U(h+l+u,t==null?void 0:t.in)}const D={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},re=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,le=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,ce=/^([+-])(\d{2})(?::?(\d{2}))?$/;function oe(a){const t={},s=a.split(D.dateTimeDelimiter);let n;if(s.length>2)return t;if(/:/.test(s[0])?n=s[0]:(t.date=s[0],n=s[1],D.timeZoneDelimiter.test(t.date)&&(t.date=a.split(D.timeZoneDelimiter)[0],n=a.substr(t.date.length,a.length))),n){const r=D.timezone.exec(n);r?(t.time=n.replace(r[1],""),t.timezone=r[1]):t.time=n}return t}function de(a,t){const s=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),n=a.match(s);if(!n)return{year:NaN,restDateString:""};const r=n[1]?parseInt(n[1]):null,i=n[2]?parseInt(n[2]):null;return{year:i===null?r:i*100,restDateString:a.slice((n[1]||n[2]).length)}}function me(a,t){if(t===null)return new Date(NaN);const s=a.match(re);if(!s)return new Date(NaN);const n=!!s[4],r=j(s[1]),i=j(s[2])-1,h=j(s[3]),l=j(s[4]),u=j(s[5])-1;if(n)return Ne(t,l,u)?xe(t,l,u):new Date(NaN);{const o=new Date(0);return!ge(t,i,h)||!pe(t,r)?new Date(NaN):(o.setUTCFullYear(t,i,Math.max(r,h)),o)}}function j(a){return a?parseInt(a):1}function ue(a){const t=a.match(le);if(!t)return NaN;const s=C(t[1]),n=C(t[2]),r=C(t[3]);return je(s,n,r)?s*R+n*L+r*1e3:NaN}function C(a){return a&&parseFloat(a.replace(",","."))||0}function he(a){if(a==="Z")return 0;const t=a.match(ce);if(!t)return 0;const s=t[1]==="+"?-1:1,n=parseInt(t[2]),r=t[3]&&parseInt(t[3])||0;return ye(n,r)?s*(n*R+r*L):NaN}function xe(a,t,s){const n=new Date(0);n.setUTCFullYear(a,0,4);const r=n.getUTCDay()||7,i=(t-1)*7+s+1-r;return n.setUTCDate(n.getUTCDate()+i),n}const fe=[31,null,31,30,31,30,31,31,30,31,30,31];function W(a){return a%400===0||a%4===0&&a%100!==0}function ge(a,t,s){return t>=0&&t<=11&&s>=1&&s<=(fe[t]||(W(a)?29:28))}function pe(a,t){return t>=1&&t<=(W(a)?366:365)}function Ne(a,t,s){return t>=1&&t<=53&&s>=0&&s<=6}function je(a,t,s){return a===24?t===0&&s===0:s>=0&&s<60&&t>=0&&t<60&&a>=0&&a<25}function ye(a,t){return t>=0&&t<=59}function be({title:a,startDate:t,endDate:s}){const[n,r]=m.useState([]),[i,h]=m.useState(null),[l,u]=m.useState(null);m.useState(null);const[o,x]=m.useState(0),[De,Z]=m.useState(null),{assignmentId:b}=v();m.useState(!1);const{courseId:T}=v(),P=c=>{const d=new Date(s),f=ie(c),N=d-f,g=Math.abs(N),p=Math.floor(g/(1e3*60*60*24)),k=Math.floor(g%(1e3*60*60*24)/(1e3*60*60)),E=Math.floor(g%(1e3*60*60)/(1e3*60)),M=Math.floor(g%(1e3*60)/1e3);return f<d?e.jsxs("div",{className:"py-1 text-blue-500",children:["Nộp sớm ",p>0?`${p} ngày `:"",k," giờ ",E," phút ",M," giây"]}):e.jsxs("div",{className:"py-1 text-rose-600",children:["Nộp trễ ",p>0?`${p} ngày `:"",k," giờ ",E," phút ",M," giây"]})};$(new Date(t),"EEEE, dd 'tháng' MM yyyy, hh:mm a",{locale:Y});const B=$(new Date(s),"EEEE, dd 'tháng' MM yyyy, hh:mm a",{locale:Y});m.useEffect(()=>{(async()=>{const d=await y.get(`courses/${T}`);d.status===200&&u(d.data.data)})()},[T]);const G=async()=>{i.score===null?w.error("Vui lòng nhập điểm",{duration:1e3}):await y.post(`/assignment-submissions/${b}/${i.studentId}/score`,{score:i.score}).then(c=>{w.success("Đã cập nhật điểm",{duration:1e3}),I()}).catch(c=>{w.error(c.response.data.message,{duration:1e3})})};m.useEffect(()=>{(async()=>{await y.get(`/assignment-submissions/assignment/${b}`).then(d=>{r(d.data.data),h(d.data.data[o]),Z([{uri:`http://localhost:8000/proxy?url=${d.data.data[o].fileSubmissionUrl}`}])}).catch(d=>{console.log(d)})})()},[b]),m.useEffect(()=>{h(n[o])},[o]);const _=c=>{const d=new Date,N=new Date(c)-d;if(N<=0)return"Đã hết hạn";const g=Math.floor(N/(1e3*60*60*24)),p=Math.floor(N%(1e3*60*60*24)/(1e3*60*60));return`Còn lại ${g} ngày ${p} giờ`},I=()=>{x(c=>c===n.length-1?0:c+1)},A=()=>{x(c=>c===0?n.length-1:c-1)};return e.jsxs("div",{className:"m-4 p-4 flex-1 rounded-lg bg-white",children:[e.jsx(O,{title:"Chấm điểm bài nộp"}),i&&e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4",children:[e.jsx("div",{className:"bg-primaryDark text-white px-4 py-2 rounded-lg text-sm font-semibold shadow-md",children:e.jsx("div",{className:"space-y-1",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-white",children:"Khoá học:"}),l&&e.jsxs(e.Fragment,{children:[e.jsx(z,{to:`/course-detail/${l==null?void 0:l.id}`,className:"text-white hover:underline",children:(l==null?void 0:l.name)||"Đang tải..."}),e.jsx("span",{children:"/"}),e.jsx(z,{to:`/submission/${l==null?void 0:l.id}/${b}`,className:"text-white hover:underline",children:a})]})]})})}),e.jsx("div",{className:"text-xl font-bold text-slate-700 pl-24",children:"Chấm điểm"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{size:"small",onClick:A,children:e.jsx(se,{className:"w-4 h-4"})}),e.jsxs(J,{size:"small",variant:"outlined",children:[e.jsx(K,{id:"student-select-label",children:"Email"}),e.jsx(V,{labelId:"student-select-label",label:"Email",value:i.studentEmail,onChange:c=>x(n.findIndex(d=>d.studentEmail===c.target.value)),sx:{minWidth:180},children:n.map((c,d)=>e.jsx(ee,{value:c.studentEmail,children:c.studentEmail},d))})]}),e.jsx(H,{size:"small",onClick:I,children:e.jsx(te,{className:"w-4 h-4"})})]}),e.jsxs(Q,{variant:"body2",color:"text.secondary",children:[o+1," of ",n.length]})]})]}),i?e.jsxs("div",{className:"border border-slate-200 bg-slate-50 text-slate-700 rounded-lg mx-64",children:[i&&e.jsxs("div",{className:"p-4 flex",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ne,{className:"w-6 h-6 text-slate-800"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-700",children:i.studentName}),e.jsx("div",{className:"text-sm text-slate-700",children:i.studentEmail})]})]}),i.score!==null?e.jsxs("div",{className:"ml-auto text-lg font-bold text-slate-700 ",children:["Điểm: ",i.score]}):e.jsx("div",{className:"ml-auto  text-lg font-bold text-rose-500 ",children:"Chưa chấm điểm"})]}),e.jsxs("div",{className:"px-4",children:[e.jsxs("div",{className:"",children:[e.jsx(F,{className:"inline mb-1 mr-2",size:16}),"Hạn chót: ",B,e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"",size:16}),e.jsx("div",{className:"py-2 text-slate-700",children:"Thời gian còn lại:"}),e.jsx("div",{className:" flex items-center",children:_(s)})]})]}),e.jsxs("div",{className:"",children:[e.jsx(F,{className:"inline mb-1 mr-2",size:16}),"Thời gian nộp:",P(i.createdAt)]})]}),i&&e.jsxs("div",{className:" shadow rounded-lg p-4",children:[e.jsx("h2",{className:"text-xl font-semibold mb-1",children:"Bài nộp"}),e.jsxs("div",{className:"space-y-4",children:[i.fileSubmissionUrl&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{children:"File đã nộp:"}),e.jsx("a",{href:`http://docs.google.com/gview?url=${i.fileSubmissionUrl}&embedded=true`,target:"_blank",rel:"noopener noreferrer",className:"hover:underline text-blue-500",children:i.fileSubmissionUrl.split("/").pop()})]}),i.textSubmission&&e.jsx("div",{className:"text-sm text-slate-600",children:i.textSubmission})]})]}),i&&e.jsxs("div",{className:" shadow rounded-lg px-4 mb-4",children:[e.jsxs("h2",{className:"text-xl font-semibold  flex items-center gap-2",children:["Chấm điểm",e.jsx(ae,{className:"w-4 h-4 text-slate-400"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"grade",className:"block text-sm font-medium text-slate-700",children:"Thang điểm 10"}),e.jsx("input",{type:"number",id:"grade",max:"10",value:i.score||"",className:"p-2 mt-1 block w-full rounded-md border focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50",onChange:c=>{const d=c.target.value?parseFloat(c.target.value):null,f=[...n];f[o].score=d,r(f)}}),e.jsxs("div",{className:"flex justify-end gap-2 ",children:[e.jsx("button",{className:"py-2 px-6 bg-primaryDark text-white rounded-lg  hover:bg-secondary transition-colors",children:"Hủy"}),e.jsx("button",{onClick:G,className:"py-2 px-6 bg-primaryDark text-white rounded-lg  hover:bg-secondary transition-colors",children:"Chấm điểm"})]})]})]})]}):e.jsx("div",{className:"text-slate-600 font-bold text-center flex justify-center items-center",children:"Chưa có học sinh nào nộp bài"})]})}const Te=()=>{const{courseId:a}=v(),{assignmentId:t}=v(),[s,n]=m.useState(null),[r,i]=m.useState(null);return m.useEffect(()=>{(async()=>{const l=await y.get(`courses/${a}`);l.status===200&&(i(l.data.data),console.log(r))})()},[a]),m.useEffect(()=>{(async()=>{const l=await y.get(`/assignments/${t}`,{headers:{"Content-Type":"application/json"}}).then(u=>u.data.data).catch(u=>{console.log(u)});n(l)})()},[t]),e.jsxs(e.Fragment,{children:[e.jsx(O,{title:"Nộp bài"}),e.jsx("div",{className:"flex flex-col min-h-[calc(100vh-193px)]",children:s&&e.jsx(be,{title:s.title,startDate:s.startDate,endDate:s.endDate})})]})};export{Te as default};
