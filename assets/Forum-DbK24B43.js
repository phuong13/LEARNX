import{d as _,j as e,ap as w,r as o,bB as D,W as F,b as y,T as I,c as R,bC as P,V as $,X as b,Y as C,bD as E,a9 as M,ad as S,D as B}from"./index-CMc9NQeQ.js";import{d as z}from"./Search-UAwBYYM6.js";import{I as A}from"./InputAdornment-CI2qOHAh.js";import{R as K}from"./quill.snow-CejoqXML.js";import{R as U}from"./ripple-button-Cu0RXGTK.js";/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=_("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),X=({nameCourse:s,onClick:l,isActive:t})=>e.jsx("div",{onClick:l,className:`flex items-center gap-2 px-3 py-2 text-slate-600 hover:rounded-lg  w-full transition mb-2 cursor-pointer border-b border-slate-400 ${t?"bg-slate-200 rounded-lg":"bg-gray-100 hover:bg-slate-200"}`,children:e.jsx("span",{className:"text-base font-semibold",children:s})}),H=()=>{const s=w(),[l,t]=o.useState(!1);return{createForum:async r=>{t(!0);try{const f=await s.post("/forums",{courseId:r,title:"New Forum",description:"Description of the new forum"})}catch{}finally{t(!1)}},loading:l}},Y=()=>{const{courses:s,loading:l}=D(),{createForum:t,loading:h}=H(),r=F(),{t:f}=y(),[p,c]=o.useState(null),[a,i]=o.useState(""),d=n=>{c(n),t(n),r(`/forum/${n}`)},x=o.useMemo(()=>a.trim()?s.filter(n=>n.name.toLowerCase().includes(a.toLowerCase())):s,[s,a]);return e.jsxs("div",{className:"h-full flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-2 p-2",children:[e.jsx("p",{className:"text-slate-600 font-semibold text-lg ",children:f("Forum")}),e.jsx(I,{fullWidth:!0,placeholder:f("forum.search_course_placeholder"),value:a,onChange:n=>i(n.target.value),variant:"outlined",size:"small",InputProps:{startAdornment:e.jsx(A,{position:"start",children:e.jsx(z,{color:"action"})})}})]}),l?e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx(R,{isLoading:!0})}):e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:x.length>0?x.map(n=>e.jsx(X,{nameCourse:n.name,onClick:()=>d(n.id),isActive:p===n.id},n.id)):e.jsx("p",{className:"text-center text-slate-700 py-4",children:f("forum.no_courses_found")})})]})},J=()=>{const s=w();o.useState(null);const[l,t]=o.useState(!1),[h,r]=o.useState(null);return{createTopicComment:async({content:c,topicId:a})=>{t(!0),r(null);try{const i=await s.post("/topiccomments",{content:c,topicId:a})}catch(i){console.error("Lỗi khi tạo topic:",i),r(i)}finally{t(!1)}},getTopicComment:async c=>{t(!0),r(null);try{return(await s.get(`/topics/comments/${c}`)).data}catch(a){return console.error("Lỗi khi lấy danh sách topic:",a),r(a),null}finally{t(!1)}}}},T="/LEARNX/assets/profile-user-DfsRXmBN.png",O=({user:s,content:l,createAt:t,topicId:h})=>{const r=JSON.parse(localStorage.getItem("user")||"{}"),{createTopicComment:f,getTopicComment:p}=J(),{t:c}=y(),[a,i]=o.useState(!1),[d,x]=o.useState(""),[n,j]=o.useState([]),[g,v]=o.useState(!1),m=async()=>{const u=await p(h);console.log("🚀 ~ fetchComment ~ data:",u),j(u.data||[])};o.useEffect(()=>{m()},[]);const N=async()=>{d.trim()&&!a&&(i(!0),await f({content:d,topicId:h}),x(""),await m(),i(!1))},k=u=>{u.key==="Enter"&&!u.shiftKey&&(u.preventDefault(),N())};return e.jsxs("div",{className:"w-full p-4 bg-white rounded-lg shadow-lg border border-slate-200",children:[e.jsxs("div",{className:" flex items-center gap-2",children:[e.jsx("div",{className:"flex-shrink-0 w-[30px] h-[30px] rounded-full overflow-hidden border border-slate-300",children:e.jsx("img",{src:s.avatarUrl||T,alt:"",className:"w-full h-full object-cover"})}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"font-semibold text-sm text-slate-700 truncate",children:s.username}),e.jsx("span",{className:"text-sm text-slate-500",children:L(t)})]})})]}),e.jsx("div",{className:"flex my-2 mx-4",children:e.jsx("p",{className:"text-slate-700 text-sm ",children:e.jsx("p",{dangerouslySetInnerHTML:{__html:l}})})}),e.jsxs("div",{className:"px-4 border-t border-slate-300 mx-2",children:[e.jsx("div",{className:"flex items-center gap-2 text-slate-600 cursor-pointer mt-2",onClick:()=>v(!g),children:e.jsx("span",{className:"text-sm text-slate-500 hover:underline hover:text-slate-600 transition",children:c("topic.comments_count",{count:n.length})})}),g&&e.jsx("div",{className:"px-4 my-2 space-y-2",children:n.length===0?e.jsx("p",{className:"text-slate-400 text-sm",children:c("topic.no_comments")}):n.map(u=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"flex-shrink-0 w-[30px] h-[30px] rounded-full overflow-hidden border border-slate-300",children:e.jsx("img",{src:u.account.avatarUrl||T,alt:"",className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-1 bg-slate-50 p-2 rounded-md",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{className:"font-semibold text-sm text-slate-700",children:u.account.email}),e.jsx("div",{className:"text-sm text-slate-500",children:L(u.createdAt)})]}),e.jsx("p",{className:"text-slate-700 text-sm",children:u.content})]})]},u.id))})]}),e.jsxs("div",{className:"px-4 flex items-center gap-3 mt-2",children:[e.jsx("div",{className:"flex-shrink-0 w-[30px] h-[30px] rounded-full overflow-hidden border border-slate-300",children:e.jsx("img",{src:r.avatar,alt:"",className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:d,onChange:u=>x(u.target.value),onKeyDown:k,placeholder:c("topic.comment_input_placeholder"),className:"w-full py-2 px-3 border-b border-slate-300 focus:outline-none text-slate-600 "}),e.jsx("button",{className:"absolute right-2 top-1/2 -translate-y-1/2 contrast-50 hover:contrast-200 transition",onClick:N,disabled:a,children:a?e.jsx(P,{className:"w-5 h-5 animate-spin text-primaryDark"}):e.jsx(W,{className:"w-5 h-5"})})]})]})]})},L=s=>{const l=new Date(s[0],s[1]-1,s[2],s[3],s[4],s[5],Math.floor(s[6]/1e6)),t=h=>String(h).padStart(2,"0");return`${t(l.getHours())}:${t(l.getMinutes())}
     ${t(l.getDate())}/${t(l.getMonth()+1)}/${l.getFullYear()}`},Q=()=>{const s=w();o.useState(null);const[l,t]=o.useState(!1),[h,r]=o.useState(null);return{createTopic:async({content:c,forumId:a})=>{t(!0),r(null);try{const i=await s.post("/topics",{content:c,forumId:a})}catch(i){console.error("Lỗi khi tạo topic:",i),r(i)}finally{t(!1)}},getTopics:async c=>{t(!0),r(null);try{return(await s.get(`/forums/forum/${c}/topics`)).data}catch(a){return console.error("Lỗi khi lấy danh sách topic:",a),r(a),null}finally{t(!1)}}}},V={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"90%",maxWidth:600,bgcolor:"background.paper",borderRadius:2,boxShadow:24,p:4},q=()=>{const[s,l]=o.useState(!1),[t,h]=o.useState(""),[r,f]=o.useState([]),[p,c]=o.useState(!1),[a,i]=o.useState(!1),{forumId:d}=$(),{t:x}=y(),{createTopic:n,getTopics:j}=Q(),g=async()=>{if(d){c(!0);try{const m=await j(d);f(m.data||[])}catch(m){console.error("Lỗi khi lấy danh sách topics:",m)}finally{c(!1)}}};o.useEffect(()=>{g()},[d]);const v=async()=>{if(!(!t.trim()||!d)){i(!0);try{await n({content:t,forumId:d}),await g(),l(!1),h("")}catch(m){console.error("Lỗi khi tạo topic:",m)}finally{i(!1)}}};return e.jsxs("div",{className:"flex flex-col gap-4 p-4 h-full focus:outline-none",tabIndex:-1,children:[d?e.jsx(U,{onClick:()=>l(!0),children:x("forum.create_topic")}):e.jsx("div",{className:"text-lg text-center text-slate-600 font-semibold pt-6 h-full bg-white rounded-lg shadow-md",children:x("forum.please_select_forum")}),p?e.jsx(b,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:e.jsx(C,{})}):r.length>0&&d?e.jsx("div",{className:"flex flex-col gap-4 h-full bg-white rounded-lg shadow-md p-6 overflow-y-auto",children:r.map(m=>e.jsx(O,{topicId:m.id,user:m.account,content:m.content,createAt:m.createdAt},m.id))}):d&&e.jsx("div",{className:"text-center mt-6 text-slate-600 font-semibold",children:x("forum.no_topics")}),e.jsx(E,{open:s,onClose:()=>l(!1),"aria-labelledby":"modal-title","aria-describedby":"modal-description",children:e.jsxs(b,{sx:V,children:[e.jsx(M,{id:"modal-title",variant:"h6",component:"h2",sx:{mb:2},children:x("forum.new_topic_title")}),e.jsx(K,{theme:"snow",value:t,onChange:h,style:{height:200,marginBottom:52},placeholder:x("forum.new_topic_placeholder")}),e.jsxs(b,{sx:{display:"flex",justifyContent:"flex-end",gap:2},children:[e.jsx(S,{variant:"outlined",color:"secondary",onClick:()=>l(!1),sx:{borderRadius:2},disabled:a,children:x("forum.cancel")}),e.jsx(S,{variant:"contained",color:"primary",onClick:v,sx:{borderRadius:2},disabled:a,children:a?e.jsx(C,{size:20,color:"inherit"}):x("forum.submit")})]})]})})]})},G=()=>e.jsxs("div",{className:"flex h-full",children:[e.jsx("div",{className:" w-1/4 h-full bg-white p-4 m-4 rounded-lg",children:e.jsx(Y,{})}),e.jsx("div",{className:"flex-grow overflow-y-auto custom-scrollbar",children:e.jsx(q,{})})]}),oe=()=>e.jsxs("div",{className:"flex flex-col min-h-[calc(100vh-170px)] ",children:[e.jsx(B,{title:"Forum"}),e.jsx("div",{className:"flex-grow h-0 overflow-hidden bg-slate-200",children:e.jsx(G,{})})]});export{oe as default};
