import{c as T,ap as $,ar as R,as as W,aq as J,r as m,q as C,al as z,j as e,D as O,t as K,C as Q,L as F,S as X,U as ee,V as te,T as se,W as L,an as ae,am as Y,z as y,A as w}from"./index-BpQV1TEo.js";import{I as H}from"./IconButton-rVg4WGwH.js";import{M as ne}from"./MenuItem-0ivOLQRT.js";import{C as re}from"./chevron-right-qZYihjEK.js";/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=T("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=T("CircleHelp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=T("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);function oe(a,t){const s=()=>J(t==null?void 0:t.in,NaN),i=he(a);let r;if(i.date){const o=xe(i.date,2);r=fe(o.restDateString,o.year)}if(!r||isNaN(+r))return s();const h=+r;let l=0,u;if(i.time&&(l=ge(i.time),isNaN(l)))return s();if(i.timezone){if(u=pe(i.timezone),isNaN(u))return s()}else{const o=new Date(h+l),x=$(0,t==null?void 0:t.in);return x.setFullYear(o.getUTCFullYear(),o.getUTCMonth(),o.getUTCDate()),x.setHours(o.getUTCHours(),o.getUTCMinutes(),o.getUTCSeconds(),o.getUTCMilliseconds()),x}return $(h+l+u,t==null?void 0:t.in)}const D={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},de=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,me=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,ue=/^([+-])(\d{2})(?::?(\d{2}))?$/;function he(a){const t={},s=a.split(D.dateTimeDelimiter);let n;if(s.length>2)return t;if(/:/.test(s[0])?n=s[0]:(t.date=s[0],n=s[1],D.timeZoneDelimiter.test(t.date)&&(t.date=a.split(D.timeZoneDelimiter)[0],n=a.substr(t.date.length,a.length))),n){const i=D.timezone.exec(n);i?(t.time=n.replace(i[1],""),t.timezone=i[1]):t.time=n}return t}function xe(a,t){const s=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),n=a.match(s);if(!n)return{year:NaN,restDateString:""};const i=n[1]?parseInt(n[1]):null,r=n[2]?parseInt(n[2]):null;return{year:r===null?i:r*100,restDateString:a.slice((n[1]||n[2]).length)}}function fe(a,t){if(t===null)return new Date(NaN);const s=a.match(de);if(!s)return new Date(NaN);const n=!!s[4],i=j(s[1]),r=j(s[2])-1,h=j(s[3]),l=j(s[4]),u=j(s[5])-1;if(n)return ve(t,l,u)?Ne(t,l,u):new Date(NaN);{const o=new Date(0);return!ye(t,r,h)||!be(t,i)?new Date(NaN):(o.setUTCFullYear(t,r,Math.max(i,h)),o)}}function j(a){return a?parseInt(a):1}function ge(a){const t=a.match(me);if(!t)return NaN;const s=S(t[1]),n=S(t[2]),i=S(t[3]);return De(s,n,i)?s*R+n*W+i*1e3:NaN}function S(a){return a&&parseFloat(a.replace(",","."))||0}function pe(a){if(a==="Z")return 0;const t=a.match(ue);if(!t)return 0;const s=t[1]==="+"?-1:1,n=parseInt(t[2]),i=t[3]&&parseInt(t[3])||0;return Ce(n,i)?s*(n*R+i*W):NaN}function Ne(a,t,s){const n=new Date(0);n.setUTCFullYear(a,0,4);const i=n.getUTCDay()||7,r=(t-1)*7+s+1-i;return n.setUTCDate(n.getUTCDate()+r),n}const je=[31,null,31,30,31,30,31,31,30,31,30,31];function Z(a){return a%400===0||a%4===0&&a%100!==0}function ye(a,t,s){return t>=0&&t<=11&&s>=1&&s<=(je[t]||(Z(a)?29:28))}function be(a,t){return t>=1&&t<=(Z(a)?366:365)}function ve(a,t,s){return t>=1&&t<=53&&s>=0&&s<=6}function De(a,t,s){return a===24?t===0&&s===0:s>=0&&s<60&&t>=0&&t<60&&a>=0&&a<25}function Ce(a,t){return t>=0&&t<=59}function we({title:a,startDate:t,endDate:s}){const[n,i]=m.useState([]),[r,h]=m.useState(null),[l,u]=m.useState(null);m.useState(null);const[o,x]=m.useState(0),[Se,P]=m.useState(null),{assignmentId:b}=C(),[B,v]=m.useState(!1),{courseId:I}=C(),A=c=>{const d=new Date(s),f=oe(c),N=d-f,g=Math.abs(N),p=Math.floor(g/(1e3*60*60*24)),k=Math.floor(g%(1e3*60*60*24)/(1e3*60*60)),M=Math.floor(g%(1e3*60*60)/(1e3*60)),U=Math.floor(g%(1e3*60)/1e3);return f<d?e.jsxs("div",{className:"py-1 text-blue-500",children:["Nộp sớm ",p>0?`${p} ngày `:"",k," giờ ",M," phút ",U," giây"]}):e.jsxs("div",{className:"py-1 text-rose-600",children:["Nộp trễ ",p>0?`${p} ngày `:"",k," giờ ",M," phút ",U," giây"]})};z(new Date(t),"EEEE, dd 'tháng' MM yyyy, hh:mm a",{locale:Y});const G=z(new Date(s),"EEEE, dd 'tháng' MM yyyy, hh:mm a",{locale:Y});m.useEffect(()=>{(async()=>{v(!0);try{const d=await y.get(`courses/${I}`);d.status===200&&u(d.data.data)}catch{}finally{v(!1)}})()},[I]);const _=async()=>{r.score===null?w.error("Vui lòng nhập điểm",{duration:1e3}):await y.post(`/assignment-submissions/${b}/${r.studentId}/score`,{score:r.score}).then(c=>{w.success("Đã cập nhật điểm",{duration:1e3}),E()}).catch(c=>{w.error(c.response.data.message,{duration:1e3})})};m.useEffect(()=>{(async()=>{v(!0);try{const d=await y.get(`/assignment-submissions/assignment/${b}`);i(d.data.data),h(d.data.data[o]),P([{uri:`http://localhost:8000/proxy?url=${d.data.data[o].fileSubmissionUrl}`}])}catch(d){console.log(d)}finally{v(!1)}})()},[b]),m.useEffect(()=>{h(n[o])},[o]);const q=c=>{const d=new Date,N=new Date(c)-d;if(N<=0)return"Đã hết hạn";const g=Math.floor(N/(1e3*60*60*24)),p=Math.floor(N%(1e3*60*60*24)/(1e3*60*60));return`Còn lại ${g} ngày ${p} giờ`},E=()=>{x(c=>c===n.length-1?0:c+1)},V=()=>{x(c=>c===0?n.length-1:c-1)};return e.jsxs("div",{className:"m-4 p-4 flex-1 rounded-lg bg-white",children:[e.jsx(O,{title:"Chấm điểm bài nộp"}),B?e.jsx(K,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:300},children:e.jsx(Q,{})}):n.length===0?e.jsx("div",{className:"text-slate-600 font-bold text-center flex justify-center items-center",children:"Chưa có học sinh nào nộp bài"}):e.jsxs(e.Fragment,{children:[r&&e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4",children:[e.jsx("div",{className:"bg-primaryDark text-white px-4 py-2 rounded-lg text-sm font-semibold shadow-md",children:e.jsx("div",{className:"space-y-1",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-white",children:"Khoá học:"}),l&&e.jsxs(e.Fragment,{children:[e.jsx(F,{to:`/course-detail/${l==null?void 0:l.id}`,className:"text-white hover:underline",children:(l==null?void 0:l.name)||"Đang tải..."}),e.jsx("span",{children:"/"}),e.jsx(F,{to:`/submission/${l==null?void 0:l.id}/${b}`,className:"text-white hover:underline",children:a})]})]})})}),e.jsx("div",{className:"text-xl font-bold text-slate-700 pl-24",children:"Chấm điểm"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{size:"small",onClick:V,children:e.jsx(ie,{className:"w-4 h-4"})}),e.jsxs(X,{size:"small",variant:"outlined",children:[e.jsx(ee,{id:"student-select-label",children:"Email"}),e.jsx(te,{labelId:"student-select-label",label:"Email",value:r.studentEmail,onChange:c=>x(n.findIndex(d=>d.studentEmail===c.target.value)),sx:{minWidth:180},children:n.map((c,d)=>e.jsx(ne,{value:c.studentEmail,children:c.studentEmail},d))})]}),e.jsx(H,{size:"small",onClick:E,children:e.jsx(re,{className:"w-4 h-4"})})]}),e.jsxs(se,{variant:"body2",color:"text.secondary",children:[o+1," of ",n.length]})]})]}),r?e.jsxs("div",{className:"border border-slate-200 bg-slate-50 text-slate-700 rounded-lg mx-64",children:[r&&e.jsxs("div",{className:"p-4 flex",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ce,{className:"w-6 h-6 text-slate-800"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-700",children:r.studentName}),e.jsx("div",{className:"text-sm text-slate-700",children:r.studentEmail})]})]}),r.score!==null?e.jsxs("div",{className:"ml-auto text-lg font-bold text-slate-700 ",children:["Điểm: ",r.score]}):e.jsx("div",{className:"ml-auto  text-lg font-bold text-rose-500 ",children:"Chưa chấm điểm"})]}),e.jsxs("div",{className:"px-4",children:[e.jsxs("div",{className:"",children:[e.jsx(L,{className:"inline mb-1 mr-2",size:16}),"Hạn chót: ",G,e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"",size:16}),e.jsx("div",{className:"py-2 text-slate-700",children:"Thời gian còn lại:"}),e.jsx("div",{className:" flex items-center",children:q(s)})]})]}),e.jsxs("div",{className:"",children:[e.jsx(L,{className:"inline mb-1 mr-2",size:16}),"Thời gian nộp:",A(r.createdAt)]})]}),r&&e.jsxs("div",{className:" shadow rounded-lg p-4",children:[e.jsx("h2",{className:"text-xl font-semibold mb-1",children:"Bài nộp"}),e.jsxs("div",{className:"space-y-4",children:[r.fileSubmissionUrl&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{children:"File đã nộp:"}),e.jsx("a",{href:`http://docs.google.com/gview?url=${r.fileSubmissionUrl}&embedded=true`,target:"_blank",rel:"noopener noreferrer",className:"hover:underline text-blue-500",children:r.fileSubmissionUrl.split("/").pop()})]}),r.textSubmission&&e.jsx("div",{className:"text-sm text-slate-600",children:r.textSubmission})]})]}),r&&e.jsxs("div",{className:" shadow rounded-lg px-4 mb-4",children:[e.jsxs("h2",{className:"text-xl font-semibold  flex items-center gap-2",children:["Chấm điểm",e.jsx(le,{className:"w-4 h-4 text-slate-400"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"grade",className:"block text-sm font-medium text-slate-700",children:"Thang điểm 10"}),e.jsx("input",{type:"number",id:"grade",max:"10",value:r.score||"",className:"p-2 mt-1 block w-full rounded-md border focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50",onChange:c=>{const d=c.target.value?parseFloat(c.target.value):null,f=[...n];f[o].score=d,i(f)}}),e.jsxs("div",{className:"flex justify-end gap-2 ",children:[e.jsx("button",{className:"py-2 px-6 bg-primaryDark text-white rounded-lg  hover:bg-secondary transition-colors",children:"Hủy"}),e.jsx("button",{onClick:_,className:"py-2 px-6 bg-primaryDark text-white rounded-lg  hover:bg-secondary transition-colors",children:"Chấm điểm"})]})]})]})]}):e.jsx("div",{className:"text-slate-600 font-bold text-center flex justify-center items-center",children:"Chưa có học sinh nào nộp bài"})]})]})}const Me=()=>{const{courseId:a}=C(),{assignmentId:t}=C(),[s,n]=m.useState(null),[i,r]=m.useState(null);return m.useEffect(()=>{(async()=>{const l=await y.get(`courses/${a}`);l.status===200&&(r(l.data.data),console.log(i))})()},[a]),m.useEffect(()=>{(async()=>{const l=await y.get(`/assignments/${t}`,{headers:{"Content-Type":"application/json"}}).then(u=>u.data.data).catch(u=>{console.log(u)});n(l)})()},[t]),e.jsxs(e.Fragment,{children:[e.jsx(O,{title:"Nộp bài"}),e.jsx("div",{className:"flex flex-col min-h-[calc(100vh-193px)]",children:s&&e.jsx(we,{title:s.title,startDate:s.startDate,endDate:s.endDate})})]})};export{Me as default};
