import{c as N,r as l,o as f,aj as E,j as e,D as I,L as k,O as A,am as G,ak as $,w as d,B as b}from"./index-BT0BlMD6.js";import{C as R}from"./chevron-right-C6DQFDXG.js";/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=N("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=N("CircleHelp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=N("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);function O({title:h,startDate:u,endDate:i}){const[c,x]=l.useState([]),[a,g]=l.useState(null),[n,m]=l.useState(null),[v,w]=l.useState(null),[r,p]=l.useState(0),[V,M]=l.useState(null),{assignmentId:o}=f(),[_,S]=l.useState(!1),{courseId:D}=f();E(new Date(u),"EEEE, dd 'tháng' MM yyyy, hh:mm a",{locale:$});const L=E(new Date(i),"EEEE, dd 'tháng' MM yyyy, hh:mm a",{locale:$});l.useEffect(()=>{(async()=>{const t=await d.get(`courses/${D}`);t.status===200&&m(t.data.data)})()},[D]);const U=async()=>{a.score===null?b.error("Vui lòng nhập điểm",{duration:1e3}):await d.post(`/assignment-submissions/${o}/${a.studentId}/score`,{score:a.score}).then(s=>{b.success("Đã cập nhật điểm",{duration:1e3}),C()}).catch(s=>{b.error(s.response.data.message,{duration:1e3})})};l.useEffect(()=>{(async()=>{await d.get(`/assignment-submissions/assignment/${o}`).then(t=>{x(t.data.data),g(t.data.data[r]),M([{uri:`http://localhost:8000/proxy?url=${t.data.data[r].fileSubmissionUrl}`}])}).catch(t=>{console.log(t)})})()},[o]),l.useEffect(()=>{g(c[r])},[r]),l.useEffect(()=>{const s=async()=>{await d.get(`/assignment-submissions/${o}/logged-in`).then(t=>{w(t.data.data)}).catch(t=>{w(null),console.log(t)})};try{S(!0),s()}finally{S(!1)}v&&console.log(v)},[o]);const F=s=>{const t=new Date,y=new Date(s)-t;if(y<=0)return"Đã hết hạn";const T=Math.floor(y/(1e3*60*60*24)),P=Math.floor(y%(1e3*60*60*24)/(1e3*60*60));return`Còn lại ${T} ngày ${P} giờ`},C=()=>{p(s=>s===c.length-1?0:s+1)},H=()=>{p(s=>s===0?c.length-1:s-1)};return e.jsxs("div",{className:"m-4 p-4 flex-1 rounded-lg bg-white",children:[e.jsx(I,{title:"Chấm điểm bài nộp"}),a&&e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4",children:[e.jsx("div",{className:"bg-primaryDark text-white px-4 py-2 rounded-lg text-sm font-semibold shadow-md",children:e.jsx("div",{className:"space-y-1",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-white",children:"Khoá học:"}),n&&e.jsxs(e.Fragment,{children:[e.jsx(k,{to:`/course-detail/${n==null?void 0:n.id}`,className:"text-white hover:underline",children:(n==null?void 0:n.name)||"Đang tải..."}),e.jsx("span",{children:"/"}),e.jsx(k,{to:`/submission/${n==null?void 0:n.id}/${o}`,className:"text-white hover:underline",children:h})]})]})})}),e.jsx("div",{className:"text-lg font-semibold text-slate-700",children:"Chấm điểm"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"p-1",onClick:H,children:e.jsx(z,{className:"w-4 h-4"})}),e.jsx("select",{className:"border rounded px-2 py-1 text-sm",value:a.studentEmail,onChange:s=>p(c.findIndex(t=>t.studentEmail===s.target.value)),children:c.map((s,t)=>e.jsx("option",{value:s.studentEmail,children:s.studentEmail},t))}),e.jsx("button",{className:"p-1",onClick:C,children:e.jsx(R,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[r+1," of ",c.length]})]})]}),a?e.jsxs("div",{className:"border border-slate-400 bg-slate-100 rounded-lg mx-64",children:[e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"mt-4",children:[e.jsx(A,{className:"inline mb-1 mr-2",size:16}),"Hạn chót: ",L,e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"",size:16}),e.jsx("div",{className:"py-2 text-gray-700",children:"Thời gian còn lại:"}),e.jsx("div",{className:" flex items-center",children:F(i)})]})]})}),a&&e.jsx("div",{className:" shadow rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(K,{className:"w-6 h-6 text-gray-400"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold",children:a.studentName}),e.jsx("div",{className:"text-sm text-gray-600",children:a.studentEmail})]})]})}),a&&e.jsxs("div",{className:" shadow rounded-lg p-4",children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Bài nộp"}),e.jsxs("div",{className:"space-y-4",children:[a.fileSubmissionUrl&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{children:"File đã nộp:"}),e.jsx("a",{href:`http://docs.google.com/gview?url=${a.fileSubmissionUrl}&embedded=true`,target:"_blank",rel:"noopener noreferrer",className:"hover:underline text-blue-500",children:a.fileSubmissionUrl.split("/").pop()})]}),a.textSubmission&&e.jsx("div",{className:"text-sm text-gray-600",children:a.textSubmission})]})]}),a&&e.jsxs("div",{className:" shadow rounded-lg p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold mb-4 flex items-center gap-2",children:["Chấm điểm",e.jsx(B,{className:"w-4 h-4 text-gray-400"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"grade",className:"block text-sm font-medium text-gray-700",children:"Thang điểm 10"}),e.jsx("input",{type:"number",id:"grade",max:"10",value:a.score||"",className:"p-2 mt-1 block w-full rounded-md border focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50",onChange:s=>{const t=s.target.value?parseFloat(s.target.value):null,j=[...c];j[r].score=t,x(j)}})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{className:"py-2 px-6 bg-primaryDark text-white rounded-lg  hover:bg-secondary transition-colors",children:"Hủy"}),e.jsx("button",{onClick:U,className:"py-2 px-6 bg-primaryDark text-white rounded-lg  hover:bg-secondary transition-colors",children:"Lưu thay đổi"})]})]})]})]}):e.jsx("div",{className:"text-slate-600 font-bold text-center flex justify-center items-center",children:"Chưa có học sinh nào nộp bài"})]})}const Q=()=>{const{courseId:h}=f(),{assignmentId:u}=f(),[i,c]=l.useState(null),[x,a]=l.useState(null);return l.useEffect(()=>{(async()=>{const n=await d.get(`courses/${h}`);n.status===200&&(a(n.data.data),console.log(x))})()},[h]),l.useEffect(()=>{(async()=>{const n=await d.get(`/assignments/${u}`,{headers:{"Content-Type":"application/json"}}).then(m=>m.data.data).catch(m=>{console.log(m)});c(n)})()},[u]),e.jsxs(e.Fragment,{children:[e.jsx(I,{title:"Nộp bài"}),e.jsx("div",{className:"flex flex-col min-h-[calc(100vh-193px)]",children:i&&e.jsx(O,{title:i.title,startDate:i.startDate,endDate:i.endDate})})]})};export{Q as default};
