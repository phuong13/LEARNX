import{c as K,r as l,aj as E,u as q,o as M,j as e,a2 as Q,L,O as H,al as W,C as X,am as Y,an as Z,ak as C,w as g,B as j,D as ee}from"./index-QTjKD8RV.js";/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=K("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);function te({title:N,content:w,startDate:o,endDate:d}){const[v,D]=l.useState(!1),[f,h]=l.useState(!0),[i,I]=l.useState(null),[u,z]=l.useState(null),O=o&&!isNaN(new Date(o))?E(new Date(o),"EEEE, dd 'tháng' MM yyyy, hh:mm a",{locale:C}):"Invalid date",R=d&&!isNaN(new Date(d))?E(new Date(d),"EEEE, dd 'tháng' MM yyyy, hh:mm a",{locale:C}):"Invalid date",{authUser:T}=q(),V=()=>{D(!v)},[B,p]=l.useState(!1),[t,b]=l.useState(null),{assignmentId:y}=M(),{courseId:k}=M(),$=a=>{const s=new Date(d),n=new Date(a),m=n-s,c=Math.abs(m),r=Math.floor(c/(1e3*60*60*24)),x=Math.floor(c/(1e3*60*60)%24),F=Math.floor(c/(1e3*60)%60),U=Math.floor(c/1e3%60);return n<s?e.jsxs("td",{className:"py-3 text-blue-500",children:["Nộp sớm ",r>0?`${r} ngày `:"",x," giờ ",F," phút ",U," giây"]}):e.jsxs("td",{className:"py-3 text-rose-600",children:["Nộp trễ ",r>0?`${r} ngày `:"",x," giờ ",F," phút ",U," giây"]})},S=a=>{if(Array.isArray(a)&&a.length>=6){const[s,n,m,c,r,x]=a;return new Date(s,n-1,m,c,r,x)}return null};l.useEffect(()=>{(async()=>{const s=await g.get(`courses/${k}`);s.status===200&&z(s.data.data)})()},[k]),l.useEffect(()=>{const a=async()=>{await g.get(`/assignment-submissions/${y}/logged-in`).then(s=>{console.log(s),s.data.data.fileSubmissionUrl!=null?b(s.data.data):b(null)}).catch(()=>{b(null)})};try{p(!0),a()}finally{p(!1)}t&&console.log(t)},[y]);const A=a=>{const s=new Date,n=new Date(a);if(isNaN(n.getTime()))return"Ngày hết hạn không hợp lệ";const m=n.getTime()-s.getTime();if(m<=0)return"Đã hết hạn";const c=Math.floor(m/(1e3*60*60*24)),r=Math.floor(m%(1e3*60*60*24)/(1e3*60*60)),x=Math.floor(m%(1e3*60*60)/(1e3*60));return c>0?`Còn lại ${c} ngày ${r} giờ`:r>0?`Còn lại ${r} giờ ${x} phút`:`Còn lại ${x} phút`},P=()=>{h(!f)},_=a=>{I(a.target.files[0])},G=()=>{I(null),D(!v)},J=async()=>{const a=new FormData;a.append("document",i);try{if(t){p(!0);const s=await g.patch(`/assignment-submissions/${y}`,a,{headers:{"Content-Type":"multipart/form-data"}});p(!1),console.log(s),s.status===200?(j(s.data.message),b(s.data.data)):j(s.data.message,{type:"error"})}else{const s={assignmentId:y,textSubmission:""};a.append("assignment",new Blob([JSON.stringify(s)],{type:"application/json"})),p(!0);const n=await g.post("/assignment-submissions",a,{headers:{"Content-Type":"multipart/form-data"}});console.log(n),p(!1),n.status===201||n.status===200?(j(n.data.message),b(n.data.data)):j(n.data.message,{type:"error"})}}catch(s){j(s.response.data.message,{type:"error"})}};return e.jsxs("div",{className:"",children:[e.jsx(Q,{isLoading:B}),e.jsxs("div",{className:"relative h-48 bg-emerald-200 overflow-hidden",children:[e.jsx("img",{src:"/src/assets/backround.jpg",alt:"Online learning illustration",className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-30"}),e.jsx("div",{className:"absolute top-4 left-4 right-4 flex justify-between items-start",children:e.jsx("div",{className:"flex items-center",children:e.jsx("div",{className:"bg-primaryDark text-white px-4 py-2 rounded-lg text-sm font-semibold shadow-md",children:e.jsx("nav",{"aria-label":"breadcrumb",children:e.jsxs("ol",{className:"flex items-center space-x-2",children:[e.jsx("i",{className:"fa-solid fa-file-arrow-up text-white text-xl mr-2"}),e.jsx("li",{children:e.jsx("a",{href:"/",className:"text-white hover:underline",children:"Trang chủ"})}),e.jsx("li",{children:e.jsx("span",{className:"mx-2 text-gray-300",children:"/"})}),e.jsx("li",{children:e.jsx("a",{href:"/my-course",className:"text-white hover:underline",children:"Khóa học"})}),e.jsx("li",{children:e.jsx("span",{className:"mx-2 text-gray-300",children:"/"})}),e.jsx(L,{to:`/course-detail/${u==null?void 0:u.id}`,className:"text-white hover:underline",children:(u==null?void 0:u.name)||"Đang tải..."}),e.jsx("li",{children:e.jsx("span",{className:"mx-2 text-gray-300",children:"/"})}),e.jsx("li",{className:"text-gray-200",children:N||"Đang tải..."})]})})})})})]}),e.jsx("div",{className:"pt-4 relative",children:e.jsxs("div",{className:"bg-white shadow-lg overflow-hidden rounded-lg",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsx("h2",{className:"text-lg font-semibold mb-2 text-slate-700",children:"Thời gian"}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between text-sm text-gray-600",children:[e.jsxs("p",{className:"mb-2 sm:mb-0",children:[e.jsx(H,{className:"inline mr-2",size:16})," Opened: ",O]}),e.jsxs("p",{children:[e.jsx(H,{className:"inline mr-2",size:16})," Due: ",R]})]})]}),e.jsxs("div",{className:"p-4 border-b border-slate-700",children:[e.jsx("h2",{className:"text-lg font-semibold mb-2 text-slate-700",children:"Hướng dẫn nộp bài"}),e.jsx("div",{className:"pb-2",dangerouslySetInnerHTML:{__html:w}}),T.role==="TEACHER"?e.jsx("button",{className:"py-2 px-4  bg-primaryDark text-white rounded-lg  hover:bg-secondary transition-colors",children:e.jsx(L,{to:`/grading/${k}/${y}`,className:"text-white",children:"Chấm điểm"})}):e.jsx("button",{onClick:V,className:"py-2 px-4 bg-primaryDark text-white rounded-lg  hover:bg-secondary transition-colors",children:t?"Sửa bài nộp":"Thêm bài nộp"}),v&&e.jsxs("div",{className:"mt-2 p-4 bg-slate-100 rounded-lg shadow-md",children:[e.jsx("div",{className:"text-lg font-semibold mb-2 text-slate-800",children:"Tải tệp bài nộp của bạn"}),i&&e.jsxs("div",{className:"mt-2",children:[e.jsx("span",{className:"text-gray-700 mr-4",children:"File đã chọn: "}),e.jsx("span",{className:"text-blue-700 mr-4",children:i.name})]}),!i&&e.jsx("input",{type:"file",accept:".pdf,.doc,.docx,.xlsx,.xls",className:"block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer",onChange:_}),t&&!i&&t.fileSubmissionUrl&&e.jsxs("div",{className:"mt-2",children:[e.jsx("span",{className:"text-gray-700 mr-4",children:"File đã nộp: "}),e.jsx("span",{className:"text-blue-700 mr-4",children:t.fileSubmissionUrl.split("/").pop()})]}),e.jsxs("div",{className:"flex justify-center mt-4",children:[e.jsx("button",{onClick:()=>J(),disabled:!i,className:`mr-4 text-white text-m px-3 py-1 rounded-lg transition-colors shadow-md ${i?"bg-blue-400 hover:bg-blue-600":"bg-slate-300 cursor-not-allowed"}`,children:"Nộp bài"}),e.jsx("button",{className:"mr-4 bg-rose-400 text-white text-m px-3 py-1 rounded-lg hover:bg-rose-700 transition-colors shadow-md",onClick:()=>G(),children:"Huỷ chọn"})]})]})]}),T.role==="STUDENT"&&e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2 cursor-pointer",onClick:P,children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-700",children:"Trạng thái bài nộp"}),f?e.jsx(W,{size:20}):e.jsx(X,{size:20})]}),f&&e.jsx("table",{className:"w-full",children:e.jsxs("tbody",{children:[e.jsxs("tr",{className:"border-b border-slate-300",children:[e.jsx("td",{className:"py-3 font-medium text-gray-700",children:"Thời gian nộp"}),t?e.jsx(e.Fragment,{children:t.updatedAt?$(S(t.updatedAt)):$(S(t.createdAt))}):e.jsx("td",{className:"py-3 text-rose-600",children:"Chưa nộp bài"})]}),e.jsxs("tr",{className:"border-b border-slate-300",children:[e.jsx("td",{className:"py-3 font-medium text-gray-700",children:"File đã nộp"}),t&&t.fileSubmissionUrl?e.jsx("td",{className:" text-gray-600",children:e.jsxs("div",{className:"flex",children:[e.jsx(se,{className:"mr-2 text-blue-600",size:18}),e.jsx("span",{className:"text-blue-500",children:t.fileSubmissionUrl.split("/").pop()})]})}):e.jsx("td",{className:"py-3 text-gray-600"})]}),e.jsxs("tr",{className:"border-b border-slate-300",children:[e.jsx("td",{className:"py-3 font-medium text-gray-700",children:"Điểm"}),e.jsx("td",{className:"py-3 text-gray-600",children:t?t.score?t.score:"Chưa chấm điểm":"..."})]}),e.jsxs("tr",{className:"border-b border-slate-300",children:[e.jsx("td",{className:"py-3 font-medium text-gray-700",children:"Thời gian còn lại"}),e.jsxs("td",{className:"py-3 text-gray-600 flex items-center",children:[e.jsx(Y,{className:"mr-2",size:16}),A(d)]})]}),e.jsxs("tr",{className:"border-b border-slate-300",children:[e.jsx("td",{className:"py-3 font-medium text-gray-700",children:"Chỉnh sửa lần cuối"}),e.jsx("td",{className:"py-3 text-gray-600",children:t&&t.updatedAt?E(S(t.updatedAt),"EEEE, dd 'tháng' MM yyyy, hh:mm a",{locale:C}):t&&E(S(t.createdAt),"EEEE, dd 'tháng' MM yyyy, hh:mm a",{locale:C})})]})]})})]}),e.jsx("div",{className:"",children:T.role==="TEACHER"&&e.jsx(Z,{timeRemaining:A(d)})})]})})]})}const ne=()=>{const{courseId:N}=M(),{assignmentId:w}=M(),[o,d]=l.useState(null),[v,D]=l.useState(null);return l.useEffect(()=>{(async()=>{const h=await g.get(`courses/${N}`);h.status===200&&(D(h.data.data),console.log(h.data.data))})()},[N]),l.useEffect(()=>{(async()=>{const h=await g.get(`/assignments/${w}`,{headers:{"Content-Type":"application/json"}}).then(i=>i.data.data).catch(i=>{console.log(i)});d(h)})()},[w]),e.jsxs(e.Fragment,{children:[e.jsx(ee,{title:"Nộp bài"}),e.jsx("div",{className:"flex flex-col min-h-[calc(100vh-193px)]",children:e.jsx("div",{className:"flex-1 pr-6 pl-6",children:o&&e.jsx(te,{title:o.title,content:o.content,startDate:o.startDate,endDate:o.endDate})})})]})};export{ne as default};
