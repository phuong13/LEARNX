import{d as I,au as F,aw as Z,ax as G,av as X,r as m,s as C,ao as L,j as e,D as P,v as ee,C as R,L as Y,S as te,U as se,V as ae,Q as ne,ar as H,aq as re,ap as O,A as y,E as w,c as ie}from"./index-CCl8Dja4.js";import{I as W}from"./IconButton-DUvvi67q.js";import{M as le}from"./MenuItem-D_2sol3o.js";import{C as ce}from"./chevron-right-CvmhpwGd.js";/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=I("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=I("CircleHelp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=I("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);function ue(a,t){const s=()=>X(t==null?void 0:t.in,NaN),l=ge(a);let r;if(l.date){const i=pe(l.date,2);r=Ne(i.restDateString,i.year)}if(!r||isNaN(+r))return s();const u=+r;let c=0,h;if(l.time&&(c=je(l.time),isNaN(c)))return s();if(l.timezone){if(h=ye(l.timezone),isNaN(h))return s()}else{const i=new Date(u+c),x=F(0,t==null?void 0:t.in);return x.setFullYear(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate()),x.setHours(i.getUTCHours(),i.getUTCMinutes(),i.getUTCSeconds(),i.getUTCMilliseconds()),x}return F(u+c+h,t==null?void 0:t.in)}const D={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},he=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,xe=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,fe=/^([+-])(\d{2})(?::?(\d{2}))?$/;function ge(a){const t={},s=a.split(D.dateTimeDelimiter);let n;if(s.length>2)return t;if(/:/.test(s[0])?n=s[0]:(t.date=s[0],n=s[1],D.timeZoneDelimiter.test(t.date)&&(t.date=a.split(D.timeZoneDelimiter)[0],n=a.substr(t.date.length,a.length))),n){const l=D.timezone.exec(n);l?(t.time=n.replace(l[1],""),t.timezone=l[1]):t.time=n}return t}function pe(a,t){const s=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),n=a.match(s);if(!n)return{year:NaN,restDateString:""};const l=n[1]?parseInt(n[1]):null,r=n[2]?parseInt(n[2]):null;return{year:r===null?l:r*100,restDateString:a.slice((n[1]||n[2]).length)}}function Ne(a,t){if(t===null)return new Date(NaN);const s=a.match(he);if(!s)return new Date(NaN);const n=!!s[4],l=j(s[1]),r=j(s[2])-1,u=j(s[3]),c=j(s[4]),h=j(s[5])-1;if(n)return we(t,c,h)?be(t,c,h):new Date(NaN);{const i=new Date(0);return!De(t,r,u)||!Ce(t,l)?new Date(NaN):(i.setUTCFullYear(t,r,Math.max(l,u)),i)}}function j(a){return a?parseInt(a):1}function je(a){const t=a.match(xe);if(!t)return NaN;const s=S(t[1]),n=S(t[2]),l=S(t[3]);return Se(s,n,l)?s*Z+n*G+l*1e3:NaN}function S(a){return a&&parseFloat(a.replace(",","."))||0}function ye(a){if(a==="Z")return 0;const t=a.match(fe);if(!t)return 0;const s=t[1]==="+"?-1:1,n=parseInt(t[2]),l=t[3]&&parseInt(t[3])||0;return Ie(n,l)?s*(n*Z+l*G):NaN}function be(a,t,s){const n=new Date(0);n.setUTCFullYear(a,0,4);const l=n.getUTCDay()||7,r=(t-1)*7+s+1-l;return n.setUTCDate(n.getUTCDate()+r),n}const ve=[31,null,31,30,31,30,31,31,30,31,30,31];function B(a){return a%400===0||a%4===0&&a%100!==0}function De(a,t,s){return t>=0&&t<=11&&s>=1&&s<=(ve[t]||(B(a)?29:28))}function Ce(a,t){return t>=1&&t<=(B(a)?366:365)}function we(a,t,s){return t>=1&&t<=53&&s>=0&&s<=6}function Se(a,t,s){return a===24?t===0&&s===0:s>=0&&s<60&&t>=0&&t<60&&a>=0&&a<25}function Ie(a,t){return t>=0&&t<=59}function Te({title:a,startDate:t,endDate:s}){const[n,l]=m.useState([]),[r,u]=m.useState(null),[c,h]=m.useState(null),[i,x]=m.useState(0),[Ee,A]=m.useState(null),{assignmentId:b}=C(),[_,v]=m.useState(!1),[T,E]=m.useState(!1),{courseId:k}=C(),V=o=>{const d=new Date(s),f=ue(o),N=d-f,g=Math.abs(N),p=Math.floor(g/(1e3*60*60*24)),U=Math.floor(g%(1e3*60*60*24)/(1e3*60*60)),$=Math.floor(g%(1e3*60*60)/(1e3*60)),z=Math.floor(g%(1e3*60)/1e3);return f<d?e.jsxs("div",{className:"py-1 text-blue-500",children:["Nộp sớm ",p>0?`${p} ngày `:"",U," giờ ",$," phút ",z," giây"]}):e.jsxs("div",{className:"py-1 text-rose-600",children:["Nộp trễ ",p>0?`${p} ngày `:"",U," giờ ",$," phút ",z," giây"]})};L(new Date(t),"EEEE, dd 'tháng' MM yyyy, hh:mm a",{locale:O});const q=L(new Date(s),"EEEE, dd 'tháng' MM yyyy, hh:mm a",{locale:O});m.useEffect(()=>{(async()=>{v(!0);try{const d=await y.get(`courses/${k}`);d.status===200&&h(d.data.data)}catch{}finally{v(!1)}})()},[k]);const J=async()=>{r.score===null?w.error("Vui lòng nhập điểm",{duration:1e3}):(E(!0),await y.post(`/assignment-submissions/${b}/${r.studentId}/score`,{score:r.score}).then(o=>{w.success("Đã cập nhật điểm",{duration:1e3}),M()}).catch(o=>{w.error(o.response.data.message,{duration:1e3})}).finally(()=>{E(!1)}))};m.useEffect(()=>{(async()=>{v(!0);try{const d=await y.get(`/assignment-submissions/assignment/${b}`);l(d.data.data),u(d.data.data[i]),A([{uri:`http://localhost:8000/proxy?url=${d.data.data[i].fileSubmissionUrl}`}])}catch(d){console.log(d)}finally{v(!1)}})()},[b]),m.useEffect(()=>{u(n[i])},[i]);const K=o=>{const d=new Date,N=new Date(o)-d;if(N<=0)return"Đã hết hạn";const g=Math.floor(N/(1e3*60*60*24)),p=Math.floor(N%(1e3*60*60*24)/(1e3*60*60));return`Còn lại ${g} ngày ${p} giờ`},M=()=>{x(o=>o===n.length-1?0:o+1)},Q=()=>{x(o=>o===0?n.length-1:o-1)};return e.jsxs("div",{className:"m-4 p-4 flex-1 rounded-lg bg-white",children:[e.jsx(P,{title:"Chấm điểm bài nộp"}),_?e.jsx(ee,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:300},children:e.jsx(R,{})}):n.length===0?e.jsx("div",{className:"text-slate-600 font-bold text-center flex justify-center items-center",children:"Chưa có học sinh nào nộp bài"}):e.jsxs(e.Fragment,{children:[r&&e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4",children:[e.jsx("div",{className:"bg-primaryDark text-white px-4 py-2 rounded-lg text-sm font-semibold shadow-md",children:e.jsx("div",{className:"space-y-1",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-white",children:"Khoá học:"}),c&&e.jsxs(e.Fragment,{children:[e.jsx(Y,{to:`/course-detail/${c==null?void 0:c.id}`,className:"text-white hover:underline",children:(c==null?void 0:c.name)||"Đang tải..."}),e.jsx("span",{children:"/"}),e.jsx(Y,{to:`/submission/${c==null?void 0:c.id}/${b}`,className:"text-white hover:underline",children:a})]})]})})}),e.jsx("div",{className:"text-xl font-bold text-slate-700 pl-24",children:"Chấm điểm"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{size:"small",onClick:Q,children:e.jsx(oe,{className:"w-4 h-4"})}),e.jsxs(te,{size:"small",variant:"outlined",children:[e.jsx(se,{id:"student-select-label",children:"Email"}),e.jsx(ae,{labelId:"student-select-label",label:"Email",value:r.studentEmail,onChange:o=>x(n.findIndex(d=>d.studentEmail===o.target.value)),sx:{minWidth:180},children:n.map((o,d)=>e.jsx(le,{value:o.studentEmail,children:o.studentEmail},d))})]}),e.jsx(W,{size:"small",onClick:M,children:e.jsx(ce,{className:"w-4 h-4"})})]}),e.jsxs(ne,{variant:"body2",color:"text.secondary",children:[i+1," of ",n.length]})]})]}),r?e.jsxs("div",{className:"border border-slate-200 bg-slate-50 text-slate-700 rounded-lg mx-64",children:[r&&e.jsxs("div",{className:"p-4 flex",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(me,{className:"w-6 h-6 text-slate-800"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-700",children:r.studentName}),e.jsx("div",{className:"text-sm text-slate-700",children:r.studentEmail})]})]}),r.score!==null?e.jsxs("div",{className:"ml-auto text-lg font-bold text-slate-700 ",children:["Điểm: ",r.score]}):e.jsx("div",{className:"ml-auto  text-lg font-bold text-rose-500 ",children:"Chưa chấm điểm"})]}),e.jsxs("div",{className:"px-4",children:[e.jsxs("div",{className:"",children:[e.jsx(H,{className:"inline mb-1 mr-2",size:16}),"Hạn chót: ",q,e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{className:"",size:16}),e.jsx("div",{className:"py-2 text-slate-700",children:"Thời gian còn lại:"}),e.jsx("div",{className:" flex items-center",children:K(s)})]})]}),e.jsxs("div",{className:"",children:[e.jsx(H,{className:"inline mb-1 mr-2",size:16}),"Thời gian nộp:",V(r.createdAt)]})]}),r&&e.jsxs("div",{className:" shadow rounded-lg p-4",children:[e.jsx("h2",{className:"text-xl font-semibold mb-1",children:"Bài nộp"}),e.jsxs("div",{className:"space-y-4",children:[r.fileSubmissionUrl&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{children:"File đã nộp:"}),e.jsx("a",{href:`http://docs.google.com/gview?url=${r.fileSubmissionUrl}&embedded=true`,target:"_blank",rel:"noopener noreferrer",className:"hover:underline text-blue-500",children:decodeURIComponent(r.fileSubmissionUrl.split("/").pop())})]}),r.textSubmission&&e.jsx("div",{className:"text-sm text-slate-600",children:r.textSubmission})]})]}),r&&e.jsxs("div",{className:" shadow rounded-lg px-4 mb-4",children:[e.jsxs("h2",{className:"text-xl font-semibold  flex items-center gap-2",children:["Chấm điểm",e.jsx(de,{className:"w-4 h-4 text-slate-400"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"grade",className:"block text-sm font-medium text-slate-700",children:"Thang điểm 10"}),e.jsx("input",{type:"number",id:"grade",max:"10",value:r.score||"",className:"p-2 mt-1 block w-full rounded-md border focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50",onChange:o=>{const d=o.target.value?parseFloat(o.target.value):null,f=[...n];f[i].score=d,l(f)}}),e.jsxs("div",{className:"flex justify-end gap-2 ",children:[e.jsx("button",{className:"py-2 px-6 bg-primaryDark text-white rounded-lg  hover:bg-secondary transition-colors",children:"Hủy"}),e.jsxs("button",{onClick:J,className:"py-2 px-6 bg-primaryDark text-white rounded-lg  hover:bg-secondary transition-colors flex items-center gap-2",disabled:T,children:[T&&e.jsx(R,{size:20,color:"inherit"}),"Chấm điểm"]})]})]})]})]}):e.jsx("div",{className:"text-slate-600 font-bold text-center flex justify-center items-center",children:"Chưa có học sinh nào nộp bài"})]})]})}const ze=()=>{const{courseId:a}=C(),{assignmentId:t}=C(),[s,n]=m.useState(null),[l,r]=m.useState(null),[u,c]=m.useState(!1);return m.useEffect(()=>{(async()=>{c(!0);try{const i=await y.get(`courses/${a}`);i.status===200&&r(i.data.data)}catch(i){console.log(i)}finally{c(!1)}})()},[a]),m.useEffect(()=>{(async()=>{c(!0);try{const i=await y.get(`/assignments/${t}`,{headers:{"Content-Type":"application/json"}});n(i.data.data)}catch(i){console.log(i)}finally{c(!1)}})()},[t]),e.jsxs(e.Fragment,{children:[e.jsx(P,{title:"Nộp bài"}),e.jsxs("div",{className:"flex flex-col min-h-[calc(100vh-193px)]",children:[u&&e.jsx(ie,{isLoading:u}),!u&&s&&e.jsx(Te,{title:s.title,startDate:s.startDate,endDate:s.endDate})]})]})};export{ze as default};
