import{c as $,P as Z,o as S,r as l,j as e,al as R,w as g,aj as E,u as Q,a2 as W,L as k,O as z,am as Y,C as ee,ak as M,B as D,D as se}from"./index-DADtTVYO.js";/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=$("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]);/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=$("FileCheck",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]]);/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=$("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);function O({timeRemaining:f}){const{assignmentId:u}=S(),[i,d]=l.useState([]);l.useEffect(()=>{(async()=>{await g.get(`/assignment-submissions/assignment/${u}`).then(c=>{d(c.data.data)}).catch(c=>{console.log(c)})})()},[u]),i.length;const b=i.filter(r=>r.fileSubmissionUrl||r.textSubmission).length,y=i.filter(r=>r.score===null||r.score===void 0).length;return e.jsxs("div",{className:"mx-auto p-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-700",children:"Thống kê điểm số"}),e.jsx("div",{className:"rounded-lg overflow-hidden",children:e.jsxs("div",{className:"divide-y divide-slate-200",children:[e.jsxs("div",{className:"flex items-center p-2 ",children:[e.jsx(ae,{className:"w-5 h-5 text-green-500 mr-4"}),e.jsx("span",{className:"text-slate-700",children:"Đã nộp bài"}),e.jsx("span",{className:"ml-auto font-semibold text-slate-700",children:b})]}),e.jsxs("div",{className:"flex items-center p-2 hover:bg-slate-50 transition-colors",children:[e.jsx(te,{className:"w-5 h-5 text-yellow-500 mr-4"}),e.jsx("span",{className:"text-slate-700",children:"Cần chấm điểm"}),e.jsx("span",{className:"ml-auto font-semibold text-slate-700",children:y})]}),e.jsxs("div",{className:"flex items-center p-2 hover:bg-slate-50 transition-colors",children:[e.jsx(R,{className:"w-5 h-5 text-red-500 mr-4"}),e.jsx("span",{className:"text-slate-700",children:"Thời gian còn lại"}),e.jsx("span",{className:"ml-auto font-semibold text-slate-700",children:f})]})]})})]})}O.propTypes={timeRemaining:Z.string.isRequired};function le({title:f,content:u,startDate:i,endDate:d}){const[b,y]=l.useState(!1),[r,c]=l.useState(!0),[o,A]=l.useState(null),[j,V]=l.useState(null),P=i&&!isNaN(new Date(i))?E(new Date(i),"EEEE, dd 'tháng' MM yyyy, hh:mm a",{locale:M}):"Invalid date",q=d&&!isNaN(new Date(d))?E(new Date(d),"EEEE, dd 'tháng' MM yyyy, hh:mm a",{locale:M}):"Invalid date",{authUser:T}=Q(),B=()=>{y(!b)},[G,N]=l.useState(!1),[s,v]=l.useState(null),{assignmentId:w}=S(),{courseId:I}=S(),F=a=>{const t=new Date(d),n=new Date(a),x=n-t,h=Math.abs(x),m=Math.floor(h/(1e3*60*60*24)),p=Math.floor(h/(1e3*60*60)%24),L=Math.floor(h/(1e3*60)%60),H=Math.floor(h/1e3%60);return n<t?e.jsxs("td",{className:"py-3 text-blue-500",children:["Nộp sớm ",m>0?`${m} ngày `:"",p," giờ ",L," phút ",H," giây"]}):e.jsxs("td",{className:"py-3 text-rose-600",children:["Nộp trễ ",m>0?`${m} ngày `:"",p," giờ ",L," phút ",H," giây"]})},C=a=>{if(Array.isArray(a)&&a.length>=6){const[t,n,x,h,m,p]=a;return new Date(t,n-1,x,h,m,p)}return null};l.useEffect(()=>{(async()=>{const t=await g.get(`courses/${I}`);t.status===200&&V(t.data.data)})()},[I]),l.useEffect(()=>{const a=async()=>{await g.get(`/assignment-submissions/${w}/logged-in`).then(t=>{console.log(t),t.data.data.fileSubmissionUrl!=null?v(t.data.data):v(null)}).catch(()=>{v(null)})};try{N(!0),a()}finally{N(!1)}s&&console.log(s)},[w]);const U=a=>{const t=new Date,n=new Date(a);if(isNaN(n.getTime()))return"Ngày hết hạn không hợp lệ";const x=n.getTime()-t.getTime();if(x<=0)return"Đã hết hạn";const h=Math.floor(x/(1e3*60*60*24)),m=Math.floor(x%(1e3*60*60*24)/(1e3*60*60)),p=Math.floor(x%(1e3*60*60)/(1e3*60));return h>0?`Còn lại ${h} ngày ${m} giờ`:m>0?`Còn lại ${m} giờ ${p} phút`:`Còn lại ${p} phút`},_=()=>{c(!r)},J=a=>{A(a.target.files[0])},K=()=>{A(null),y(!b)},X=async()=>{const a=new FormData;a.append("document",o);try{if(s){N(!0);const t=await g.patch(`/assignment-submissions/${w}`,a,{headers:{"Content-Type":"multipart/form-data"}});N(!1),console.log(t),t.status===200?(D(t.data.message),v(t.data.data)):D(t.data.message,{type:"error"})}else{const t={assignmentId:w,textSubmission:""};a.append("assignment",new Blob([JSON.stringify(t)],{type:"application/json"})),N(!0);const n=await g.post("/assignment-submissions",a,{headers:{"Content-Type":"multipart/form-data"}});console.log(n),N(!1),n.status===201||n.status===200?(D(n.data.message),v(n.data.data)):D(n.data.message,{type:"error"})}}catch(t){D(t.response.data.message,{type:"error"})}};return e.jsxs("div",{className:"",children:[e.jsx(W,{isLoading:G}),e.jsxs("div",{className:"relative h-48 bg-emerald-200 overflow-hidden",children:[e.jsx("img",{src:"/LEARNX/src/assets/backround.jpg",alt:"Online learning illustration",className:"w-full h-fit object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-30"}),e.jsx("div",{className:"absolute top-4 left-4 right-4 flex justify-between items-start",children:e.jsx("div",{className:"flex items-center",children:e.jsx("div",{className:"bg-primaryDark text-white px-4 py-2 rounded-lg text-sm font-semibold shadow-md",children:e.jsx("nav",{"aria-label":"breadcrumb",children:e.jsxs("ol",{className:"flex items-center space-x-2",children:[e.jsx("i",{className:"fa-solid fa-file-arrow-up text-white text-xl mr-2"}),e.jsx("li",{children:e.jsx(k,{to:"/",className:"text-white hover:underline",children:"Trang chủ"})}),e.jsx("li",{children:e.jsx("span",{className:"mx-2 text-gray-300",children:"/"})}),e.jsx("li",{children:e.jsx(k,{to:"/my-course",className:"text-white hover:underline",children:"Khóa học"})}),e.jsx("li",{children:e.jsx("span",{className:"mx-2 text-gray-300",children:"/"})}),e.jsx(k,{to:`/course-detail/${j==null?void 0:j.id}`,className:"text-white hover:underline",children:(j==null?void 0:j.name)||"Đang tải..."}),e.jsx("li",{children:e.jsx("span",{className:"mx-2 text-gray-300",children:"/"})}),e.jsx("li",{className:"text-gray-200",children:f||"Đang tải..."})]})})})})})]}),e.jsx("div",{className:"pt-4 relative",children:e.jsxs("div",{className:"bg-white shadow-lg overflow-hidden rounded-lg",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsx("h2",{className:"text-lg font-semibold mb-2 text-slate-700",children:"Thời gian"}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between text-sm text-gray-600",children:[e.jsxs("p",{className:"mb-2 sm:mb-0",children:[e.jsx(z,{className:"inline mr-2",size:16})," Opened: ",P]}),e.jsxs("p",{children:[e.jsx(z,{className:"inline mr-2",size:16})," Due: ",q]})]})]}),e.jsxs("div",{className:"p-4 border-b border-slate-700",children:[e.jsx("h2",{className:"text-lg font-semibold mb-2 text-slate-700",children:"Hướng dẫn nộp bài"}),e.jsx("div",{className:"pb-2",dangerouslySetInnerHTML:{__html:u}}),T.role==="TEACHER"?e.jsx("button",{className:"py-2 px-4  bg-primaryDark text-white rounded-lg  hover:bg-secondary transition-colors",children:e.jsx(k,{to:`/grading/${I}/${w}`,className:"text-white",children:"Chấm điểm"})}):e.jsx("button",{onClick:B,className:"py-2 px-4 bg-primaryDark text-white rounded-lg  hover:bg-secondary transition-colors",children:s?"Sửa bài nộp":"Thêm bài nộp"}),b&&e.jsxs("div",{className:"mt-2 p-4 bg-slate-100 rounded-lg shadow-md",children:[e.jsx("div",{className:"text-lg font-semibold mb-2 text-slate-800",children:"Tải tệp bài nộp của bạn"}),o&&e.jsxs("div",{className:"mt-2",children:[e.jsx("span",{className:"text-gray-700 mr-4",children:"File đã chọn: "}),e.jsx("span",{className:"text-blue-700 mr-4",children:o.name})]}),!o&&e.jsx("input",{type:"file",accept:".pdf,.doc,.docx,.xlsx,.xls",className:"block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer",onChange:J}),s&&!o&&s.fileSubmissionUrl&&e.jsxs("div",{className:"mt-2",children:[e.jsx("span",{className:"text-gray-700 mr-4",children:"File đã nộp: "}),e.jsx("span",{className:"text-blue-700 mr-4",children:s.fileSubmissionUrl.split("/").pop()})]}),e.jsxs("div",{className:"flex justify-center mt-4",children:[e.jsx("button",{onClick:()=>X(),disabled:!o,className:`mr-4 text-white text-m px-3 py-1 rounded-lg transition-colors shadow-md ${o?"bg-blue-400 hover:bg-blue-600":"bg-slate-300 cursor-not-allowed"}`,children:"Nộp bài"}),e.jsx("button",{className:"mr-4 bg-rose-400 text-white text-m px-3 py-1 rounded-lg hover:bg-rose-700 transition-colors shadow-md",onClick:()=>K(),children:"Huỷ chọn"})]})]})]}),T.role==="STUDENT"&&e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2 cursor-pointer",onClick:_,children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-700",children:"Trạng thái bài nộp"}),r?e.jsx(Y,{size:20}):e.jsx(ee,{size:20})]}),r&&e.jsx("table",{className:"w-full",children:e.jsxs("tbody",{children:[e.jsxs("tr",{className:"border-b border-slate-300",children:[e.jsx("td",{className:"py-3 font-medium text-gray-700",children:"Thời gian nộp"}),s?e.jsx(e.Fragment,{children:s.updatedAt?F(C(s.updatedAt)):F(C(s.createdAt))}):e.jsx("td",{className:"py-3 text-rose-600",children:"Chưa nộp bài"})]}),e.jsxs("tr",{className:"border-b border-slate-300",children:[e.jsx("td",{className:"py-3 font-medium text-gray-700",children:"File đã nộp"}),s&&s.fileSubmissionUrl?e.jsx("td",{className:" text-gray-600",children:e.jsxs("div",{className:"flex",children:[e.jsx(ne,{className:"mr-2 text-blue-600",size:18}),e.jsxs("a",{className:"text-blue-500 hover:underline",href:`http://docs.google.com/gview?url=${s.fileSubmissionUrl}&embedded=true`,children:["                                                            ",s.fileSubmissionUrl.split("/").pop()]})]})}):e.jsx("td",{className:"py-3 text-gray-600"})]}),e.jsxs("tr",{className:"border-b border-slate-300",children:[e.jsx("td",{className:"py-3 font-medium text-gray-700",children:"Điểm"}),e.jsx("td",{className:"py-3 text-gray-600",children:s?s.score?s.score:"Chưa chấm điểm":"..."})]}),e.jsxs("tr",{className:"border-b border-slate-300",children:[e.jsx("td",{className:"py-3 font-medium text-gray-700",children:"Thời gian còn lại"}),e.jsxs("td",{className:"py-3 text-gray-600 flex items-center",children:[e.jsx(R,{className:"mr-2",size:16}),U(d)]})]}),e.jsxs("tr",{className:"border-b border-slate-300",children:[e.jsx("td",{className:"py-3 font-medium text-gray-700",children:"Chỉnh sửa lần cuối"}),e.jsx("td",{className:"py-3 text-gray-600",children:s&&s.updatedAt?E(C(s.updatedAt),"EEEE, dd 'tháng' MM yyyy, hh:mm a",{locale:M}):s&&E(C(s.createdAt),"EEEE, dd 'tháng' MM yyyy, hh:mm a",{locale:M})})]})]})})]}),e.jsx("div",{className:"",children:T.role==="TEACHER"&&e.jsx(O,{timeRemaining:U(d)})})]})})]})}const re=()=>{const{courseId:f}=S(),{assignmentId:u}=S(),[i,d]=l.useState(null),[b,y]=l.useState(null);return l.useEffect(()=>{(async()=>{const c=await g.get(`courses/${f}`);c.status===200&&(y(c.data.data),console.log(c.data.data))})()},[f]),l.useEffect(()=>{(async()=>{const c=await g.get(`/assignments/${u}`,{headers:{"Content-Type":"application/json"}}).then(o=>o.data.data).catch(o=>{console.log(o)});d(c)})()},[u]),e.jsxs(e.Fragment,{children:[e.jsx(se,{title:"Nộp bài"}),e.jsx("div",{className:"flex flex-col min-h-[calc(100vh-193px)]",children:e.jsx("div",{className:"flex-1 pr-6 pl-6",children:i&&e.jsx(le,{title:i.title,content:i.content,startDate:i.startDate,endDate:i.endDate})})})]})};export{re as default};
