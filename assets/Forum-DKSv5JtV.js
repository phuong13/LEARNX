import{d as C,j as e,af as b,r as l,bs as T,t as S,b as N,T as k,c as L,s as _,v as F,C as w,D}from"./index-DSFyDKEM.js";import{d as I}from"./Search-DQzMMAbS.js";import{I as P}from"./InputAdornment-D_8qXyf6.js";/**
 * @license lucide-react v0.439.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=C("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),E=({nameCourse:s,onClick:r,isActive:t})=>e.jsx("div",{onClick:r,className:`flex items-center gap-2 px-3 py-2 text-slate-600 hover:rounded-lg  w-full transition mb-2 cursor-pointer border-b border-slate-400 ${t?"bg-slate-200 rounded-lg":"bg-gray-100 hover:bg-slate-200"}`,children:e.jsx("span",{className:"text-base font-semibold",children:s})}),M=()=>{const s=b(),[r,t]=l.useState(!1);return{createForum:async n=>{t(!0);try{const h=await s.post("/forums",{courseId:n,title:"New Forum",description:"Description of the new forum"})}catch{}finally{t(!1)}},loading:r}},z=()=>{const{courses:s,loading:r}=T(),{createForum:t,loading:x}=M(),n=S(),{t:h}=N(),[f,i]=l.useState(null),[a,d]=l.useState(""),m=c=>{i(c),t(c),n(`/forum/${c}`)},u=l.useMemo(()=>a.trim()?s.filter(c=>c.name.toLowerCase().includes(a.toLowerCase())):s,[s,a]);return e.jsxs("div",{className:"h-full flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-2 p-2",children:[e.jsx("p",{className:"text-slate-600 font-semibold text-lg ",children:h("Forum")}),e.jsx(k,{fullWidth:!0,placeholder:h("forum.search_course_placeholder"),value:a,onChange:c=>d(c.target.value),variant:"outlined",size:"small",InputProps:{startAdornment:e.jsx(P,{position:"start",children:e.jsx(I,{color:"action"})})}})]}),r?e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx(L,{isLoading:!0})}):e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:u.length>0?u.map(c=>e.jsx(E,{nameCourse:c.name,onClick:()=>m(c.id),isActive:f===c.id},c.id)):e.jsx("p",{className:"text-center text-slate-700 py-4",children:h("forum.no_courses_found")})})]})},A=()=>{const s=b();l.useState(null);const[r,t]=l.useState(!1),[x,n]=l.useState(null);return{createTopicComment:async({content:i,topicId:a})=>{t(!0),n(null);try{const d=await s.post("/topiccomments",{content:i,topicId:a})}catch(d){console.error("Lỗi khi tạo topic:",d),n(d)}finally{t(!1)}},getTopicComment:async i=>{t(!0),n(null);try{return(await s.get(`/topics/comments/${i}`)).data}catch(a){return console.error("Lỗi khi lấy danh sách topic:",a),n(a),null}finally{t(!1)}}}},v="/LEARNX/assets/profile-user-DfsRXmBN.png",R=({user:s,content:r,createAt:t,topicId:x})=>{const n=JSON.parse(localStorage.getItem("user")||"{}"),{createTopicComment:h,getTopicComment:f}=A(),{t:i}=N(),[a,d]=l.useState(""),[m,u]=l.useState([]),[c,g]=l.useState(!1),p=async()=>{const o=await f(x);u(o.data||[])};l.useEffect(()=>{p()},[]);const j=async()=>{a.trim()&&(await h({content:a,topicId:x}),d(""),p())};return e.jsxs("div",{className:"w-full p-4 bg-white rounded-lg shadow-lg border border-slate-200",children:[e.jsxs("div",{className:" flex items-center gap-2",children:[e.jsx("div",{className:"flex-shrink-0 w-[30px] h-[30px] rounded-full overflow-hidden border border-slate-300",children:e.jsx("img",{src:s.avatarUrl||v,alt:"",className:"w-full h-full object-cover"})}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"font-semibold text-sm text-slate-700 truncate",children:s.username}),e.jsx("span",{className:"text-sm text-slate-500",children:y(t)})]})})]}),e.jsx("div",{className:"flex my-2 mx-4",children:e.jsxs("p",{className:"text-slate-700 text-sm ",children:[e.jsx("span",{className:"text-slate-700 text-base font-semibold"})," ",r]})}),e.jsxs("div",{className:"px-4 border-t border-slate-300 mx-2",children:[e.jsx("div",{className:"flex items-center gap-2 text-slate-600 cursor-pointer mt-2",onClick:()=>g(!c),children:e.jsx("span",{className:"text-sm text-slate-500 hover:underline hover:text-slate-600 transition",children:i("topic.comments_count",{count:m.length})})}),c&&e.jsx("div",{className:"px-4 my-2 space-y-2",children:m.length===0?e.jsx("p",{className:"text-slate-400 text-sm",children:i("topic.no_comments")}):m.map(o=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"flex-shrink-0 w-[30px] h-[30px] rounded-full overflow-hidden border border-slate-300",children:e.jsx("img",{src:v,alt:"",className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-1 bg-slate-50 p-2 rounded-md",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{className:"font-semibold text-sm text-slate-700",children:o.account.email}),e.jsx("div",{className:"text-sm text-slate-500",children:y(o.createdAt)})]}),e.jsx("p",{className:"text-slate-700 text-sm",children:o.content})]})]},o.id))})]}),e.jsxs("div",{className:"px-4 flex items-center gap-3 mt-2",children:[e.jsx("div",{className:"flex-shrink-0 w-[30px] h-[30px] rounded-full overflow-hidden border border-slate-300",children:e.jsx("img",{src:n.avatar||v,alt:"",className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:a,onChange:o=>d(o.target.value),placeholder:i("topic.comment_input_placeholder"),className:"w-full py-2 px-3 border-b border-slate-300 focus:outline-none text-slate-600 "}),e.jsx("button",{className:"absolute right-2 top-1/2 -translate-y-1/2 contrast-50 hover:contrast-200 transition",onClick:j,children:e.jsx($,{className:"w-5 h-5"})})]})]})]})},y=s=>{const r=new Date(s[0],s[1]-1,s[2],s[3],s[4],s[5],Math.floor(s[6]/1e6)),t=x=>String(x).padStart(2,"0");return`${t(r.getHours())}:${t(r.getMinutes())}
     ${t(r.getDate())}/${t(r.getMonth()+1)}/${r.getFullYear()}`},B=()=>{const s=b();l.useState(null);const[r,t]=l.useState(!1),[x,n]=l.useState(null);return{createTopic:async({content:i,forumId:a})=>{t(!0),n(null);try{const d=await s.post("/topics",{content:i,forumId:a})}catch(d){console.error("Lỗi khi tạo topic:",d),n(d)}finally{t(!1)}},getTopics:async i=>{t(!0),n(null);try{return(await s.get(`/forums/forum/${i}/topics`)).data}catch(a){return console.error("Lỗi khi lấy danh sách topic:",a),n(a),null}finally{t(!1)}}}},U=()=>{const[s,r]=l.useState(!1),[t,x]=l.useState(""),[n,h]=l.useState([]),[f,i]=l.useState(!1),[a,d]=l.useState(!1),{forumId:m}=_(),{t:u}=N(),{createTopic:c,getTopics:g}=B(),p=async()=>{if(m){i(!0);try{const o=await g(m);h(o.data||[])}catch(o){console.error("Lỗi khi lấy danh sách topics:",o)}finally{i(!1)}}};l.useEffect(()=>{p()},[m]);const j=async()=>{if(!(!t.trim()||!m)){d(!0);try{await c({content:t,forumId:m}),await p(),r(!1),x("")}catch(o){console.error("Lỗi khi tạo topic:",o)}finally{d(!1)}}};return e.jsxs("div",{className:"flex flex-col gap-4 p-4 h-full focus:outline-none",tabIndex:-1,children:[m?e.jsx("button",{className:"py-2 px-4 bg-primaryDark text-white rounded-lg hover:bg-secondary transition-colors",onClick:()=>r(!0),children:u("forum.create_topic")}):e.jsx("div",{className:"text-lg text-center text-slate-600 font-semibold pt-6 h-full bg-white rounded-lg shadow-md",children:u("forum.please_select_forum")}),f?e.jsx(F,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:e.jsx(w,{})}):n.length>0&&m?e.jsx("div",{className:"flex flex-col gap-4 h-full bg-white rounded-lg shadow-md p-6 overflow-y-auto",children:n.map(o=>e.jsx(R,{topicId:o.id,user:o.account,content:o.content,createAt:o.createdAt},o.id))}):m&&e.jsx("div",{className:"text-center mt-6 text-slate-600 font-semibold",children:u("forum.no_topics")}),s&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-30",children:e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-lg w-[90%] max-w-xl h-[405px]",children:[e.jsx("h2",{className:"text-lg text-slate-600 font-semibold mb-2",children:u("forum.new_topic_title")}),e.jsx("textarea",{className:"w-full h-[300px] border border-slate-300 focus:border-slate-400 outline-none p-2 rounded-md text-slate-600",placeholder:u("forum.new_topic_placeholder"),value:t,onChange:o=>x(o.target.value),autoFocus:!0}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{className:"py-2 px-6 bg-primaryDark text-white rounded-lg hover:bg-secondary transition-colors",onClick:()=>r(!1),children:u("forum.cancel")}),e.jsx("button",{className:"py-2 px-6 bg-primaryDark text-white rounded-lg hover:bg-secondary transition-colors flex items-center justify-center",onClick:j,disabled:a,children:a?e.jsx(w,{size:20,color:"inherit"}):u("forum.submit")})]})]})})]})},X=()=>e.jsxs("div",{className:"flex h-full",children:[e.jsx("div",{className:" w-1/4 h-full bg-white p-4 m-4 rounded-lg",children:e.jsx(z,{})}),e.jsx("div",{className:"flex-grow overflow-y-auto custom-scrollbar",children:e.jsx(U,{})})]}),W=()=>e.jsxs("div",{className:"flex flex-col min-h-[calc(100vh-193px)] ",children:[e.jsx(D,{title:"Forum"}),e.jsx("div",{className:"flex-grow h-0 overflow-hidden bg-slate-200",children:e.jsx(X,{})})]});export{W as default};
